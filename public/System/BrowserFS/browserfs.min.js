!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.BrowserFS=e():t.BrowserFS=e()}(this,function(){return function(t){var e={};function n(r){if(e[r])return e[r].exports;var i=e[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)n.d(r,i,function(e){return t[e]}.bind(null,i));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=1)}([function(t,e){var n;n=function(){return this}();try{n=n||Function("return this")()||(0,eval)("this")}catch(t){"object"==typeof window&&(n=window)}t.exports=n},function(t,e,n){"use strict";(function(t){var r=n(2),i=n(6);function o(t){var e=Object.create(null);return t&&Object.keys(t).forEach(function(n){if("default"!==n){var r=Object.getOwnPropertyDescriptor(t,n);Object.defineProperty(e,n,r.get?r:{enumerable:!0,get:function(){return t[n]}})}}),e.default=t,Object.freeze(e)}var s,c=o(r),a=o(i);!function(t){t[t.EPERM=1]="EPERM",t[t.ENOENT=2]="ENOENT",t[t.EIO=5]="EIO",t[t.EBADF=9]="EBADF",t[t.EACCES=13]="EACCES",t[t.EBUSY=16]="EBUSY",t[t.EEXIST=17]="EEXIST",t[t.ENOTDIR=20]="ENOTDIR",t[t.EISDIR=21]="EISDIR",t[t.EINVAL=22]="EINVAL",t[t.EFBIG=27]="EFBIG",t[t.ENOSPC=28]="ENOSPC",t[t.EROFS=30]="EROFS",t[t.ENOTEMPTY=39]="ENOTEMPTY",t[t.ENOTSUP=95]="ENOTSUP"}(s||(s={}));var u={};u[s.EPERM]="Operation not permitted.",u[s.ENOENT]="No such file or directory.",u[s.EIO]="Input/output error.",u[s.EBADF]="Bad file descriptor.",u[s.EACCES]="Permission denied.",u[s.EBUSY]="Resource busy or locked.",u[s.EEXIST]="File exists.",u[s.ENOTDIR]="File is not a directory.",u[s.EISDIR]="File is a directory.",u[s.EINVAL]="Invalid argument.",u[s.EFBIG]="File is too big.",u[s.ENOSPC]="No space left on disk.",u[s.EROFS]="Cannot modify a read-only file system.",u[s.ENOTEMPTY]="Directory is not empty.",u[s.ENOTSUP]="Operation is not supported.";var f,h=function(t){function e(e,n,r){void 0===n&&(n=u[e]),t.call(this,n),this.syscall="",this.errno=e,this.code=s[e],this.path=r,this.stack=(new t).stack,this.message="Error: "+this.code+": "+n+(this.path?", '"+this.path+"'":"")}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.fromJSON=function(t){var n=new e(0);return n.errno=t.errno,n.code=t.code,n.path=t.path,n.stack=t.stack,n.message=t.message,n},e.fromBuffer=function(t,n){return void 0===n&&(n=0),e.fromJSON(JSON.parse(t.toString("utf8",n+4,n+4+t.readUInt32LE(n))))},e.FileError=function(t,n){return new e(t,u[t],n)},e.ENOENT=function(t){return this.FileError(s.ENOENT,t)},e.EEXIST=function(t){return this.FileError(s.EEXIST,t)},e.EISDIR=function(t){return this.FileError(s.EISDIR,t)},e.ENOTDIR=function(t){return this.FileError(s.ENOTDIR,t)},e.EPERM=function(t){return this.FileError(s.EPERM,t)},e.ENOTEMPTY=function(t){return this.FileError(s.ENOTEMPTY,t)},e.prototype.toString=function(){return this.message},e.prototype.toJSON=function(){return{errno:this.errno,code:this.code,path:this.path,stack:this.stack,message:this.message}},e.prototype.writeToBuffer=function(t,e){void 0===t&&(t=Buffer.alloc(this.bufferSize())),void 0===e&&(e=0);var n=t.write(JSON.stringify(this.toJSON()),e+4);return t.writeUInt32LE(n,e),t},e.prototype.bufferSize=function(){return 4+Buffer.byteLength(JSON.stringify(this.toJSON()))},e}(Error),p=Object.freeze({__proto__:null,ApiError:h,get ErrorCode(){return s},ErrorStrings:u});!function(t){t[t.NOP=0]="NOP",t[t.THROW_EXCEPTION=1]="THROW_EXCEPTION",t[t.TRUNCATE_FILE=2]="TRUNCATE_FILE",t[t.CREATE_FILE=3]="CREATE_FILE"}(f||(f={}));var l,y=function t(e){if(this.flagStr=e,t.validFlagStrs.indexOf(e)<0)throw new h(s.EINVAL,"Invalid flag: "+e)};y.getFileFlag=function(t){return y.flagCache.hasOwnProperty(t)?y.flagCache[t]:y.flagCache[t]=new y(t)},y.prototype.getFlagString=function(){return this.flagStr},y.prototype.isReadable=function(){return-1!==this.flagStr.indexOf("r")||-1!==this.flagStr.indexOf("+")},y.prototype.isWriteable=function(){return-1!==this.flagStr.indexOf("w")||-1!==this.flagStr.indexOf("a")||-1!==this.flagStr.indexOf("+")},y.prototype.isTruncating=function(){return-1!==this.flagStr.indexOf("w")},y.prototype.isAppendable=function(){return-1!==this.flagStr.indexOf("a")},y.prototype.isSynchronous=function(){return-1!==this.flagStr.indexOf("s")},y.prototype.isExclusive=function(){return-1!==this.flagStr.indexOf("x")},y.prototype.pathExistsAction=function(){return this.isExclusive()?f.THROW_EXCEPTION:this.isTruncating()?f.TRUNCATE_FILE:f.NOP},y.prototype.pathNotExistsAction=function(){return(this.isWriteable()||this.isAppendable())&&"r+"!==this.flagStr?f.CREATE_FILE:f.THROW_EXCEPTION},y.flagCache={},y.validFlagStrs=["r","r+","rs","rs+","w","wx","w+","wx+","a","ax","a+","ax+"],function(t){t[t.FILE=32768]="FILE",t[t.DIRECTORY=16384]="DIRECTORY",t[t.SYMLINK=40960]="SYMLINK"}(l||(l={}));var d=function(t,e,n,r,i,o,s){this.dev=0,this.ino=0,this.rdev=0,this.nlink=1,this.blksize=4096,this.uid=0,this.gid=0,this.fileData=null,this.size=e;var c=0;if("number"!=typeof r&&(r=c=Date.now()),"number"!=typeof i&&(c||(c=Date.now()),i=c),"number"!=typeof o&&(c||(c=Date.now()),o=c),"number"!=typeof s&&(c||(c=Date.now()),s=c),this.atimeMs=r,this.ctimeMs=o,this.mtimeMs=i,this.birthtimeMs=s,n)this.mode=n;else switch(t){case l.FILE:this.mode=420;break;case l.DIRECTORY:default:this.mode=511}this.blocks=Math.ceil(e/512),this.mode<4096&&(this.mode|=t)},g={atime:{configurable:!0},mtime:{configurable:!0},ctime:{configurable:!0},birthtime:{configurable:!0}};d.fromBuffer=function(t){var e=t.readUInt32LE(0),n=t.readUInt32LE(4),r=t.readDoubleLE(8),i=t.readDoubleLE(16),o=t.readDoubleLE(24);return new d(61440&n,e,4095&n,r,i,o)},d.clone=function(t){return new d(61440&t.mode,t.size,4095&t.mode,t.atimeMs,t.mtimeMs,t.ctimeMs,t.birthtimeMs)},g.atime.get=function(){return new Date(this.atimeMs)},g.mtime.get=function(){return new Date(this.mtimeMs)},g.ctime.get=function(){return new Date(this.ctimeMs)},g.birthtime.get=function(){return new Date(this.birthtimeMs)},d.prototype.toBuffer=function(){var t=Buffer.alloc(32);return t.writeUInt32LE(this.size,0),t.writeUInt32LE(this.mode,4),t.writeDoubleLE(this.atime.getTime(),8),t.writeDoubleLE(this.mtime.getTime(),16),t.writeDoubleLE(this.ctime.getTime(),24),t},d.prototype.isFile=function(){return(61440&this.mode)===l.FILE},d.prototype.isDirectory=function(){return(61440&this.mode)===l.DIRECTORY},d.prototype.isSymbolicLink=function(){return(61440&this.mode)===l.SYMLINK},d.prototype.chmod=function(t){this.mode=61440&this.mode|t},d.prototype.isSocket=function(){return!1},d.prototype.isBlockDevice=function(){return!1},d.prototype.isCharacterDevice=function(){return!1},d.prototype.isFIFO=function(){return!1},Object.defineProperties(d.prototype,g);var w,m="undefined"!=typeof window?window:"undefined"!=typeof self?self:t;if("undefined"!=typeof setImmediate)w=setImmediate;else{var v=m,E=[];if(function(){if(void 0!==v.importScripts||!v.postMessage)return!1;var t=!0,e=v.onmessage;return v.onmessage=function(){t=!1},v.postMessage("","*"),v.onmessage=e,t}()){w=function(t){E.push(t),v.postMessage("zero-timeout-message","*")};var S=function(t){if(t.source===self&&"zero-timeout-message"===t.data&&(t.stopPropagation?t.stopPropagation():t.cancelBubble=!0,E.length>0))return E.shift()()};v.addEventListener?v.addEventListener("message",S,!0):v.attachEvent("onmessage",S)}else if(v.MessageChannel){var _=new v.MessageChannel;_.port1.onmessage=function(t){if(E.length>0)return E.shift()()},w=function(t){E.push(t),_.port2.postMessage("")}}else w=function(t){return setTimeout(t,0)}}var b=w,N=function(t,e){return t};function I(t,e){if("function"!=typeof t)throw new Error("Callback must be a function.");var n=N(t,e);switch(e){case 1:return function(t){b(function(){return n(t)})};case 2:return function(t,e){b(function(){return n(t,e)})};case 3:return function(t,e,r){b(function(){return n(t,e,r)})};default:throw new Error("Invalid invocation of wrapCb.")}}function T(t){if(t)return t;throw new h(s.EIO,"Initialize BrowserFS with a file system using BrowserFS.initialize(filesystem)")}function O(t,e){switch(typeof t){case"number":return t;case"string":var n=parseInt(t,8);return isNaN(n)?e:n;default:return e}}function F(t){if(t instanceof Date)return t;if("number"==typeof t)return new Date(1e3*t);throw new h(s.EINVAL,"Invalid time.")}function P(t){if(t.indexOf("\0")>=0)throw new h(s.EINVAL,"Path must be a string without null bytes.");if(""===t)throw new h(s.EINVAL,"Path must not be empty.");return a.resolve(t)}function k(t,e,n,r){switch(null===t?"null":typeof t){case"object":return{encoding:void 0!==t.encoding?t.encoding:e,flag:void 0!==t.flag?t.flag:n,mode:O(t.mode,r)};case"string":return{encoding:t,flag:n,mode:r};case"null":case"undefined":case"function":return{encoding:e,flag:n,mode:r};default:throw new TypeError('"options" must be a string or an object, got '+typeof t+" instead.")}}function A(){}var L=function(){this.F_OK=0,this.R_OK=4,this.W_OK=2,this.X_OK=1,this.root=null,this.fdMap={},this.nextFd=100};L.prototype.initialize=function(t){if(!t.constructor.isAvailable())throw new h(s.EINVAL,"Tried to instantiate BrowserFS with an unavailable file system.");return this.root=t},L.prototype._toUnixTimestamp=function(t){if("number"==typeof t)return t;if(t instanceof Date)return t.getTime()/1e3;throw new Error("Cannot parse time: "+t)},L.prototype.getRootFS=function(){return this.root?this.root:null},L.prototype.rename=function(t,e,n){void 0===n&&(n=A);var r=I(n,1);try{T(this.root).rename(P(t),P(e),r)}catch(t){r(t)}},L.prototype.renameSync=function(t,e){T(this.root).renameSync(P(t),P(e))},L.prototype.exists=function(t,e){void 0===e&&(e=A);var n=I(e,1);try{return T(this.root).exists(P(t),n)}catch(t){return n(!1)}},L.prototype.existsSync=function(t){try{return T(this.root).existsSync(P(t))}catch(t){return!1}},L.prototype.stat=function(t,e){void 0===e&&(e=A);var n=I(e,2);try{return T(this.root).stat(P(t),!1,n)}catch(t){return n(t)}},L.prototype.statSync=function(t){return T(this.root).statSync(P(t),!1)},L.prototype.lstat=function(t,e){void 0===e&&(e=A);var n=I(e,2);try{return T(this.root).stat(P(t),!0,n)}catch(t){return n(t)}},L.prototype.lstatSync=function(t){return T(this.root).statSync(P(t),!0)},L.prototype.truncate=function(t,e,n){void 0===e&&(e=0),void 0===n&&(n=A);var r=0;"function"==typeof e?n=e:"number"==typeof e&&(r=e);var i=I(n,1);try{if(r<0)throw new h(s.EINVAL);return T(this.root).truncate(P(t),r,i)}catch(t){return i(t)}},L.prototype.truncateSync=function(t,e){if(void 0===e&&(e=0),e<0)throw new h(s.EINVAL);return T(this.root).truncateSync(P(t),e)},L.prototype.unlink=function(t,e){void 0===e&&(e=A);var n=I(e,1);try{return T(this.root).unlink(P(t),n)}catch(t){return n(t)}},L.prototype.unlinkSync=function(t){return T(this.root).unlinkSync(P(t))},L.prototype.open=function(t,e,n,r){var i=this;void 0===r&&(r=A);var o=O(n,420),s=I(r="function"==typeof n?n:r,2);try{T(this.root).open(P(t),y.getFileFlag(e),o,function(t,e){e?s(t,i.getFdForFile(e)):s(t)})}catch(t){s(t)}},L.prototype.openSync=function(t,e,n){return void 0===n&&(n=420),this.getFdForFile(T(this.root).openSync(P(t),y.getFileFlag(e),O(n,420)))},L.prototype.readFile=function(t,e,n){void 0===e&&(e={}),void 0===n&&(n=A);var r=k(e,null,"r",null),i=I(n="function"==typeof e?e:n,2);try{var o=y.getFileFlag(r.flag);return o.isReadable()?T(this.root).readFile(P(t),r.encoding,o,i):i(new h(s.EINVAL,"Flag passed to readFile must allow for reading."))}catch(t){return i(t)}},L.prototype.readFileSync=function(t,e){void 0===e&&(e={});var n=k(e,null,"r",null),r=y.getFileFlag(n.flag);if(!r.isReadable())throw new h(s.EINVAL,"Flag passed to readFile must allow for reading.");return T(this.root).readFileSync(P(t),n.encoding,r)},L.prototype.writeFile=function(t,e,n,r){void 0===n&&(n={}),void 0===r&&(r=A);var i=k(n,"utf8","w",420),o=I(r="function"==typeof n?n:r,1);try{var c=y.getFileFlag(i.flag);return c.isWriteable()?T(this.root).writeFile(P(t),e,i.encoding,c,i.mode,o):o(new h(s.EINVAL,"Flag passed to writeFile must allow for writing."))}catch(t){return o(t)}},L.prototype.writeFileSync=function(t,e,n){var r=k(n,"utf8","w",420),i=y.getFileFlag(r.flag);if(!i.isWriteable())throw new h(s.EINVAL,"Flag passed to writeFile must allow for writing.");return T(this.root).writeFileSync(P(t),e,r.encoding,i,r.mode)},L.prototype.appendFile=function(t,e,n,r){void 0===r&&(r=A);var i=k(n,"utf8","a",420),o=I(r="function"==typeof n?n:r,1);try{var c=y.getFileFlag(i.flag);if(!c.isAppendable())return o(new h(s.EINVAL,"Flag passed to appendFile must allow for appending."));T(this.root).appendFile(P(t),e,i.encoding,c,i.mode,o)}catch(t){o(t)}},L.prototype.appendFileSync=function(t,e,n){var r=k(n,"utf8","a",420),i=y.getFileFlag(r.flag);if(!i.isAppendable())throw new h(s.EINVAL,"Flag passed to appendFile must allow for appending.");return T(this.root).appendFileSync(P(t),e,r.encoding,i,r.mode)},L.prototype.fstat=function(t,e){void 0===e&&(e=A);var n=I(e,2);try{this.fd2file(t).stat(n)}catch(t){n(t)}},L.prototype.fstatSync=function(t){return this.fd2file(t).statSync()},L.prototype.close=function(t,e){var n=this;void 0===e&&(e=A);var r=I(e,1);try{this.fd2file(t).close(function(e){e||n.closeFd(t),r(e)})}catch(t){r(t)}},L.prototype.closeSync=function(t){this.fd2file(t).closeSync(),this.closeFd(t)},L.prototype.ftruncate=function(t,e,n){void 0===n&&(n=A);var r="number"==typeof e?e:0,i=I(n="function"==typeof e?e:n,1);try{var o=this.fd2file(t);if(r<0)throw new h(s.EINVAL);o.truncate(r,i)}catch(t){i(t)}},L.prototype.ftruncateSync=function(t,e){void 0===e&&(e=0);var n=this.fd2file(t);if(e<0)throw new h(s.EINVAL);n.truncateSync(e)},L.prototype.fsync=function(t,e){void 0===e&&(e=A);var n=I(e,1);try{this.fd2file(t).sync(n)}catch(t){n(t)}},L.prototype.fsyncSync=function(t){this.fd2file(t).syncSync()},L.prototype.fdatasync=function(t,e){void 0===e&&(e=A);var n=I(e,1);try{this.fd2file(t).datasync(n)}catch(t){n(t)}},L.prototype.fdatasyncSync=function(t){this.fd2file(t).datasyncSync()},L.prototype.write=function(t,e,n,r,i,o){void 0===o&&(o=A);var c,a,u,f=null;if("string"==typeof e){var p="utf8";switch(typeof n){case"function":o=n;break;case"number":f=n,p="string"==typeof r?r:"utf8",o="function"==typeof i?i:o;break;default:return(o="function"==typeof r?r:"function"==typeof i?i:o)(new h(s.EINVAL,"Invalid arguments."))}a=0,u=(c=Buffer.from(e,p)).length}else c=e,a=n,u=r,f="number"==typeof i?i:null,o="function"==typeof i?i:o;var l=I(o,3);try{var y=this.fd2file(t);void 0!==f&&null!==f||(f=y.getPos()),y.write(c,a,u,f,l)}catch(t){l(t)}},L.prototype.writeSync=function(t,e,n,r,i){var o,s,c,a=0;if("string"==typeof e){c="number"==typeof n?n:null;var u="string"==typeof r?r:"utf8";a=0,s=(o=Buffer.from(e,u)).length}else o=e,a=n,s=r,c="number"==typeof i?i:null;var f=this.fd2file(t);return void 0!==c&&null!==c||(c=f.getPos()),f.writeSync(o,a,s,c)},L.prototype.read=function(t,e,n,r,i,o){var s,c,a,u,f;if(void 0===o&&(o=A),"number"==typeof e){a=e,s=n;var h=r;o="function"==typeof i?i:o,c=0,u=Buffer.alloc(a),f=I(function(t,e,n){if(t)return o(t);o(t,n.toString(h),e)},3)}else u=e,c=n,a=r,s=i,f=I(o,3);try{var p=this.fd2file(t);void 0!==s&&null!==s||(s=p.getPos()),p.read(u,c,a,s,f)}catch(t){f(t)}},L.prototype.readSync=function(t,e,n,r,i){var o,s,c,a,u=!1,f="utf8";"number"==typeof e?(c=e,a=n,f=r,s=0,o=Buffer.alloc(c),u=!0):(o=e,s=n,c=r,a=i);var h=this.fd2file(t);void 0!==a&&null!==a||(a=h.getPos());var p=h.readSync(o,s,c,a);return u?[o.toString(f),p]:p},L.prototype.fchown=function(t,e,n,r){void 0===r&&(r=A);var i=I(r,1);try{this.fd2file(t).chown(e,n,i)}catch(t){i(t)}},L.prototype.fchownSync=function(t,e,n){this.fd2file(t).chownSync(e,n)},L.prototype.fchmod=function(t,e,n){var r=I(n,1);try{var i="string"==typeof e?parseInt(e,8):e;this.fd2file(t).chmod(i,r)}catch(t){r(t)}},L.prototype.fchmodSync=function(t,e){var n="string"==typeof e?parseInt(e,8):e;this.fd2file(t).chmodSync(n)},L.prototype.futimes=function(t,e,n,r){void 0===r&&(r=A);var i=I(r,1);try{var o=this.fd2file(t);"number"==typeof e&&(e=new Date(1e3*e)),"number"==typeof n&&(n=new Date(1e3*n)),o.utimes(e,n,i)}catch(t){i(t)}},L.prototype.futimesSync=function(t,e,n){this.fd2file(t).utimesSync(F(e),F(n))},L.prototype.rmdir=function(t,e){void 0===e&&(e=A);var n=I(e,1);try{t=P(t),T(this.root).rmdir(t,n)}catch(t){n(t)}},L.prototype.rmdirSync=function(t){return t=P(t),T(this.root).rmdirSync(t)},L.prototype.mkdir=function(t,e,n){void 0===n&&(n=A),"function"==typeof e&&(n=e,e=511);var r=I(n,1);try{t=P(t),T(this.root).mkdir(t,e,r)}catch(t){r(t)}},L.prototype.mkdirSync=function(t,e){T(this.root).mkdirSync(P(t),O(e,511))},L.prototype.readdir=function(t,e){void 0===e&&(e=A);var n=I(e,2);try{t=P(t),T(this.root).readdir(t,n)}catch(t){n(t)}},L.prototype.readdirSync=function(t){return t=P(t),T(this.root).readdirSync(t)},L.prototype.link=function(t,e,n){void 0===n&&(n=A);var r=I(n,1);try{t=P(t),e=P(e),T(this.root).link(t,e,r)}catch(t){r(t)}},L.prototype.linkSync=function(t,e){return t=P(t),e=P(e),T(this.root).linkSync(t,e)},L.prototype.symlink=function(t,e,n,r){void 0===r&&(r=A);var i="string"==typeof n?n:"file",o=I(r="function"==typeof n?n:r,1);try{if("file"!==i&&"dir"!==i)return o(new h(s.EINVAL,"Invalid type: "+i));t=P(t),e=P(e),T(this.root).symlink(t,e,i,o)}catch(t){o(t)}},L.prototype.symlinkSync=function(t,e,n){if(n){if("file"!==n&&"dir"!==n)throw new h(s.EINVAL,"Invalid type: "+n)}else n="file";return t=P(t),e=P(e),T(this.root).symlinkSync(t,e,n)},L.prototype.readlink=function(t,e){void 0===e&&(e=A);var n=I(e,2);try{t=P(t),T(this.root).readlink(t,n)}catch(t){n(t)}},L.prototype.readlinkSync=function(t){return t=P(t),T(this.root).readlinkSync(t)},L.prototype.chown=function(t,e,n,r){void 0===r&&(r=A);var i=I(r,1);try{t=P(t),T(this.root).chown(t,!1,e,n,i)}catch(t){i(t)}},L.prototype.chownSync=function(t,e,n){t=P(t),T(this.root).chownSync(t,!1,e,n)},L.prototype.lchown=function(t,e,n,r){void 0===r&&(r=A);var i=I(r,1);try{t=P(t),T(this.root).chown(t,!0,e,n,i)}catch(t){i(t)}},L.prototype.lchownSync=function(t,e,n){t=P(t),T(this.root).chownSync(t,!0,e,n)},L.prototype.chmod=function(t,e,n){void 0===n&&(n=A);var r=I(n,1);try{var i=O(e,-1);if(i<0)throw new h(s.EINVAL,"Invalid mode.");T(this.root).chmod(P(t),!1,i,r)}catch(t){r(t)}},L.prototype.chmodSync=function(t,e){var n=O(e,-1);if(n<0)throw new h(s.EINVAL,"Invalid mode.");t=P(t),T(this.root).chmodSync(t,!1,n)},L.prototype.lchmod=function(t,e,n){void 0===n&&(n=A);var r=I(n,1);try{var i=O(e,-1);if(i<0)throw new h(s.EINVAL,"Invalid mode.");T(this.root).chmod(P(t),!0,i,r)}catch(t){r(t)}},L.prototype.lchmodSync=function(t,e){var n=O(e,-1);if(n<1)throw new h(s.EINVAL,"Invalid mode.");T(this.root).chmodSync(P(t),!0,n)},L.prototype.utimes=function(t,e,n,r){void 0===r&&(r=A);var i=I(r,1);try{T(this.root).utimes(P(t),F(e),F(n),i)}catch(t){i(t)}},L.prototype.utimesSync=function(t,e,n){T(this.root).utimesSync(P(t),F(e),F(n))},L.prototype.realpath=function(t,e,n){void 0===n&&(n=A);var r="object"==typeof e?e:{},i=I(n="function"==typeof e?e:A,2);try{t=P(t),T(this.root).realpath(t,r,i)}catch(t){i(t)}},L.prototype.realpathSync=function(t,e){return void 0===e&&(e={}),t=P(t),T(this.root).realpathSync(t,e)},L.prototype.watchFile=function(t,e,n){throw new h(s.ENOTSUP)},L.prototype.unwatchFile=function(t,e){throw new h(s.ENOTSUP)},L.prototype.watch=function(t,e,n){throw new h(s.ENOTSUP)},L.prototype.access=function(t,e,n){throw new h(s.ENOTSUP)},L.prototype.accessSync=function(t,e){throw new h(s.ENOTSUP)},L.prototype.createReadStream=function(t,e){throw new h(s.ENOTSUP)},L.prototype.createWriteStream=function(t,e){throw new h(s.ENOTSUP)},L.prototype.wrapCallbacks=function(t){N=t},L.prototype.getFdForFile=function(t){var e=this.nextFd++;return this.fdMap[e]=t,e},L.prototype.fd2file=function(t){var e=this.fdMap[t];if(e)return e;throw new h(s.EBADF,"Invalid file descriptor.")},L.prototype.closeFd=function(t){delete this.fdMap[t]},L.Stats=d;var R=new L,D={},x=L.prototype;function B(){throw new Error("BFS has reached an impossible code path; please file a bug.")}function U(t,e,n){n.existsSync(t)||(U(a.dirname(t),e,n),n.mkdirSync(t,e))}function M(t){var e=z(t),n=e.byteOffset,r=e.byteLength;return 0===n&&r===e.buffer.byteLength?e.buffer:e.buffer.slice(n,n+r)}function z(t){return t instanceof Uint8Array?t:new Uint8Array(t)}function C(t){return t instanceof Buffer?t:0===t.byteOffset&&t.byteLength===t.buffer.byteLength?j(t.buffer):Buffer.from(t.buffer,t.byteOffset,t.byteLength)}function j(t){return Buffer.from(t)}function Y(t,e,n){if(void 0===e&&(e=0),void 0===n&&(n=t.length),e<0||n<0||n>t.length||e>n)throw new TypeError("Invalid slice bounds on buffer of length "+t.length+": ["+e+", "+n+"]");if(0===t.length)return X();var r=z(t),i=t[0],o=(i+1)%255;return t[0]=o,r[0]===o?(r[0]=i,C(r.slice(e,n))):(t[0]=i,C(r.subarray(e,n)))}Object.keys(x).forEach(function(t){"function"==typeof R[t]?D[t]=function(){return R[t].apply(R,arguments)}:D[t]=R[t]}),D.changeFSModule=function(t){R=t},D.getFSModule=function(){return R},D.FS=L,D.Stats=L.Stats;var V=null;function X(){return V||(V=Buffer.alloc(0))}var W=Object.freeze({__proto__:null,arrayBuffer2Buffer:j,arrayish2Buffer:function(t){return t instanceof Buffer?t:t instanceof Uint8Array?C(t):Buffer.from(t)},buffer2ArrayBuffer:M,buffer2Uint8array:z,bufferValidator:function(t,e){Buffer.isBuffer(t)?e():e(new h(s.EINVAL,"option must be a Buffer."))},copyingSlice:Y,deprecationMessage:function(t,e,n){t&&console.warn("["+e+"] Direct file system constructor usage is deprecated for this file system, and will be removed in the next major version. Please use the '"+e+".Create("+JSON.stringify(n)+", callback)' method instead. See https://github.com/jvilk/BrowserFS/issues/176 for more details.")},emptyBuffer:X,fail:B,mkdirpSync:U,uint8Array2Buffer:C}),H=function(){};H.prototype.supportsLinks=function(){return!1},H.prototype.diskSpace=function(t,e){e(0,0)},H.prototype.openFile=function(t,e,n){throw new h(s.ENOTSUP)},H.prototype.createFile=function(t,e,n,r){throw new h(s.ENOTSUP)},H.prototype.open=function(t,e,n,r){var i=this;this.stat(t,!1,function(o,c){if(o)switch(e.pathNotExistsAction()){case f.CREATE_FILE:return i.stat(a.dirname(t),!1,function(o,s){o?r(o):s&&!s.isDirectory()?r(h.ENOTDIR(a.dirname(t))):i.createFile(t,e,n,r)});case f.THROW_EXCEPTION:return r(h.ENOENT(t));default:return r(new h(s.EINVAL,"Invalid FileFlag object."))}else{if(c&&c.isDirectory())return r(h.EISDIR(t));switch(e.pathExistsAction()){case f.THROW_EXCEPTION:return r(h.EEXIST(t));case f.TRUNCATE_FILE:return i.openFile(t,e,function(t,e){t?r(t):e?e.truncate(0,function(){e.sync(function(){r(null,e)})}):B()});case f.NOP:return i.openFile(t,e,r);default:return r(new h(s.EINVAL,"Invalid FileFlag object."))}}})},H.prototype.rename=function(t,e,n){n(new h(s.ENOTSUP))},H.prototype.renameSync=function(t,e){throw new h(s.ENOTSUP)},H.prototype.stat=function(t,e,n){n(new h(s.ENOTSUP))},H.prototype.statSync=function(t,e){throw new h(s.ENOTSUP)},H.prototype.openFileSync=function(t,e,n){throw new h(s.ENOTSUP)},H.prototype.createFileSync=function(t,e,n){throw new h(s.ENOTSUP)},H.prototype.openSync=function(t,e,n){var r;try{r=this.statSync(t,!1)}catch(r){switch(e.pathNotExistsAction()){case f.CREATE_FILE:if(!this.statSync(a.dirname(t),!1).isDirectory())throw h.ENOTDIR(a.dirname(t));return this.createFileSync(t,e,n);case f.THROW_EXCEPTION:throw h.ENOENT(t);default:throw new h(s.EINVAL,"Invalid FileFlag object.")}}if(r.isDirectory())throw h.EISDIR(t);switch(e.pathExistsAction()){case f.THROW_EXCEPTION:throw h.EEXIST(t);case f.TRUNCATE_FILE:return this.unlinkSync(t),this.createFileSync(t,e,r.mode);case f.NOP:return this.openFileSync(t,e,n);default:throw new h(s.EINVAL,"Invalid FileFlag object.")}},H.prototype.unlink=function(t,e){e(new h(s.ENOTSUP))},H.prototype.unlinkSync=function(t){throw new h(s.ENOTSUP)},H.prototype.rmdir=function(t,e){e(new h(s.ENOTSUP))},H.prototype.rmdirSync=function(t){throw new h(s.ENOTSUP)},H.prototype.mkdir=function(t,e,n){n(new h(s.ENOTSUP))},H.prototype.mkdirSync=function(t,e){throw new h(s.ENOTSUP)},H.prototype.readdir=function(t,e){e(new h(s.ENOTSUP))},H.prototype.readdirSync=function(t){throw new h(s.ENOTSUP)},H.prototype.exists=function(t,e){this.stat(t,null,function(t){e(!t)})},H.prototype.existsSync=function(t){try{return this.statSync(t,!0),!0}catch(t){return!1}},H.prototype.realpath=function(t,e,n){if(this.supportsLinks())for(var r=t.split(a.sep),i=0;i<r.length;i++){var o=r.slice(0,i+1);r[i]=a.join.apply(null,o)}else this.exists(t,function(e){e?n(null,t):n(h.ENOENT(t))})},H.prototype.realpathSync=function(t,e){if(this.supportsLinks()){for(var n=t.split(a.sep),r=0;r<n.length;r++){var i=n.slice(0,r+1);n[r]=a.join.apply(a,i)}return n.join(a.sep)}if(this.existsSync(t))return t;throw h.ENOENT(t)},H.prototype.truncate=function(t,e,n){this.open(t,y.getFileFlag("r+"),420,function(t,r){if(t)return n(t);r.truncate(e,function(t){r.close(function(e){n(t||e)})})})},H.prototype.truncateSync=function(t,e){var n=this.openSync(t,y.getFileFlag("r+"),420);try{n.truncateSync(e)}catch(t){throw t}finally{n.closeSync()}},H.prototype.readFile=function(t,e,n,r){var i=r;this.open(t,n,420,function(t,n){if(t)return r(t);r=function(t,e){n.close(function(n){return t||(t=n),i(t,e)})},n.stat(function(t,i){if(t)return r(t);var o=Buffer.alloc(i.size);n.read(o,0,i.size,0,function(t){if(t)return r(t);if(null===e)return r(t,o);try{r(null,o.toString(e))}catch(t){r(t)}})})})},H.prototype.readFileSync=function(t,e,n){var r=this.openSync(t,n,420);try{var i=r.statSync(),o=Buffer.alloc(i.size);return r.readSync(o,0,i.size,0),r.closeSync(),null===e?o:o.toString(e)}finally{r.closeSync()}},H.prototype.writeFile=function(t,e,n,r,i,o){var s=o;this.open(t,r,420,function(t,r){if(t)return o(t);o=function(t){r.close(function(e){s(t||e)})};try{"string"==typeof e&&(e=Buffer.from(e,n))}catch(t){return o(t)}r.write(e,0,e.length,0,o)})},H.prototype.writeFileSync=function(t,e,n,r,i){var o=this.openSync(t,r,i);try{"string"==typeof e&&(e=Buffer.from(e,n)),o.writeSync(e,0,e.length,0)}finally{o.closeSync()}},H.prototype.appendFile=function(t,e,n,r,i,o){var s=o;this.open(t,r,i,function(t,r){if(t)return o(t);o=function(t){r.close(function(e){s(t||e)})},"string"==typeof e&&(e=Buffer.from(e,n)),r.write(e,0,e.length,null,o)})},H.prototype.appendFileSync=function(t,e,n,r,i){var o=this.openSync(t,r,i);try{"string"==typeof e&&(e=Buffer.from(e,n)),o.writeSync(e,0,e.length,null)}finally{o.closeSync()}},H.prototype.chmod=function(t,e,n,r){r(new h(s.ENOTSUP))},H.prototype.chmodSync=function(t,e,n){throw new h(s.ENOTSUP)},H.prototype.chown=function(t,e,n,r,i){i(new h(s.ENOTSUP))},H.prototype.chownSync=function(t,e,n,r){throw new h(s.ENOTSUP)},H.prototype.utimes=function(t,e,n,r){r(new h(s.ENOTSUP))},H.prototype.utimesSync=function(t,e,n){throw new h(s.ENOTSUP)},H.prototype.link=function(t,e,n){n(new h(s.ENOTSUP))},H.prototype.linkSync=function(t,e){throw new h(s.ENOTSUP)},H.prototype.symlink=function(t,e,n,r){r(new h(s.ENOTSUP))},H.prototype.symlinkSync=function(t,e,n){throw new h(s.ENOTSUP)},H.prototype.readlink=function(t,e){e(new h(s.ENOTSUP))},H.prototype.readlinkSync=function(t){throw new h(s.ENOTSUP)};var q=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.supportsSynch=function(){return!0},e.prototype.rename=function(t,e,n){try{this.renameSync(t,e),n()}catch(t){n(t)}},e.prototype.stat=function(t,e,n){try{n(null,this.statSync(t,e))}catch(t){n(t)}},e.prototype.open=function(t,e,n,r){try{r(null,this.openSync(t,e,n))}catch(t){r(t)}},e.prototype.unlink=function(t,e){try{this.unlinkSync(t),e()}catch(t){e(t)}},e.prototype.rmdir=function(t,e){try{this.rmdirSync(t),e()}catch(t){e(t)}},e.prototype.mkdir=function(t,e,n){try{this.mkdirSync(t,e),n()}catch(t){n(t)}},e.prototype.readdir=function(t,e){try{e(null,this.readdirSync(t))}catch(t){e(t)}},e.prototype.chmod=function(t,e,n,r){try{this.chmodSync(t,e,n),r()}catch(t){r(t)}},e.prototype.chown=function(t,e,n,r,i){try{this.chownSync(t,e,n,r),i()}catch(t){i(t)}},e.prototype.utimes=function(t,e,n,r){try{this.utimesSync(t,e,n),r()}catch(t){r(t)}},e.prototype.link=function(t,e,n){try{this.linkSync(t,e),n()}catch(t){n(t)}},e.prototype.symlink=function(t,e,n,r){try{this.symlinkSync(t,e,n),r()}catch(t){r(t)}},e.prototype.readlink=function(t,e){try{e(null,this.readlinkSync(t))}catch(t){e(t)}},e}(H),J=function(t,e,n,r,i,o){this.id=t,this.size=e,this.mode=n,this.atime=r,this.mtime=i,this.ctime=o};J.fromBuffer=function(t){if(void 0===t)throw new Error("NO");return new J(t.toString("ascii",30),t.readUInt32LE(0),t.readUInt16LE(4),t.readDoubleLE(6),t.readDoubleLE(14),t.readDoubleLE(22))},J.prototype.toStats=function(){return new d((61440&this.mode)===l.DIRECTORY?l.DIRECTORY:l.FILE,this.size,this.mode,this.atime,this.mtime,this.ctime)},J.prototype.getSize=function(){return 30+this.id.length},J.prototype.toBuffer=function(t){return void 0===t&&(t=Buffer.alloc(this.getSize())),t.writeUInt32LE(this.size,0),t.writeUInt16LE(this.mode,4),t.writeDoubleLE(this.atime,6),t.writeDoubleLE(this.mtime,14),t.writeDoubleLE(this.ctime,22),t.write(this.id,30,this.id.length,"ascii"),t},J.prototype.update=function(t){var e=!1;this.size!==t.size&&(this.size=t.size,e=!0),this.mode!==t.mode&&(this.mode=t.mode,e=!0);var n=t.atime.getTime();this.atime!==n&&(this.atime=n,e=!0);var r=t.mtime.getTime();this.mtime!==r&&(this.mtime=r,e=!0);var i=t.ctime.getTime();return this.ctime!==i&&(this.ctime=i,e=!0),e},J.prototype.isFile=function(){return(61440&this.mode)===l.FILE},J.prototype.isDirectory=function(){return(61440&this.mode)===l.DIRECTORY};var K=function(){};K.prototype.sync=function(t){t(new h(s.ENOTSUP))},K.prototype.syncSync=function(){throw new h(s.ENOTSUP)},K.prototype.datasync=function(t){this.sync(t)},K.prototype.datasyncSync=function(){return this.syncSync()},K.prototype.chown=function(t,e,n){n(new h(s.ENOTSUP))},K.prototype.chownSync=function(t,e){throw new h(s.ENOTSUP)},K.prototype.chmod=function(t,e){e(new h(s.ENOTSUP))},K.prototype.chmodSync=function(t){throw new h(s.ENOTSUP)},K.prototype.utimes=function(t,e,n){n(new h(s.ENOTSUP))},K.prototype.utimesSync=function(t,e){throw new h(s.ENOTSUP)};var G=function(t){function e(e,n,r,i,o){if(t.call(this),this._pos=0,this._dirty=!1,this._fs=e,this._path=n,this._flag=r,this._stat=i,this._buffer=o||X(),this._stat.size!==this._buffer.length&&this._flag.isReadable())throw new Error("Invalid buffer: Buffer is "+this._buffer.length+" long, yet Stats object specifies that file is "+this._stat.size+" long.")}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getBuffer=function(){return this._buffer},e.prototype.getStats=function(){return this._stat},e.prototype.getFlag=function(){return this._flag},e.prototype.getPath=function(){return this._path},e.prototype.getPos=function(){return this._flag.isAppendable()?this._stat.size:this._pos},e.prototype.advancePos=function(t){return this._pos+=t},e.prototype.setPos=function(t){return this._pos=t},e.prototype.sync=function(t){try{this.syncSync(),t()}catch(e){t(e)}},e.prototype.syncSync=function(){throw new h(s.ENOTSUP)},e.prototype.close=function(t){try{this.closeSync(),t()}catch(e){t(e)}},e.prototype.closeSync=function(){throw new h(s.ENOTSUP)},e.prototype.stat=function(t){try{t(null,d.clone(this._stat))}catch(e){t(e)}},e.prototype.statSync=function(){return d.clone(this._stat)},e.prototype.truncate=function(t,e){try{this.truncateSync(t),this._flag.isSynchronous()&&!D.getRootFS().supportsSynch()&&this.sync(e),e()}catch(t){return e(t)}},e.prototype.truncateSync=function(t){if(this._dirty=!0,!this._flag.isWriteable())throw new h(s.EPERM,"File not opened with a writeable mode.");if(this._stat.mtimeMs=Date.now(),t>this._buffer.length){var e=Buffer.alloc(t-this._buffer.length,0);return this.writeSync(e,0,e.length,this._buffer.length),void(this._flag.isSynchronous()&&D.getRootFS().supportsSynch()&&this.syncSync())}this._stat.size=t;var n=Buffer.alloc(t);this._buffer.copy(n,0,0,t),this._buffer=n,this._flag.isSynchronous()&&D.getRootFS().supportsSynch()&&this.syncSync()},e.prototype.write=function(t,e,n,r,i){try{i(null,this.writeSync(t,e,n,r),t)}catch(t){i(t)}},e.prototype.writeSync=function(t,e,n,r){if(this._dirty=!0,void 0!==r&&null!==r||(r=this.getPos()),!this._flag.isWriteable())throw new h(s.EPERM,"File not opened with a writeable mode.");var i=r+n;if(i>this._stat.size&&(this._stat.size=i,i>this._buffer.length)){var o=Buffer.alloc(i);this._buffer.copy(o),this._buffer=o}var c=t.copy(this._buffer,r,e,e+n);return this._stat.mtimeMs=Date.now(),this._flag.isSynchronous()?(this.syncSync(),c):(this.setPos(r+c),c)},e.prototype.read=function(t,e,n,r,i){try{i(null,this.readSync(t,e,n,r),t)}catch(t){i(t)}},e.prototype.readSync=function(t,e,n,r){if(!this._flag.isReadable())throw new h(s.EPERM,"File not opened with a readable mode.");void 0!==r&&null!==r||(r=this.getPos()),r+n>this._stat.size&&(n=this._stat.size-r);var i=this._buffer.copy(t,e,r,r+n);return this._stat.atimeMs=Date.now(),this._pos=r+n,i},e.prototype.chmod=function(t,e){try{this.chmodSync(t),e()}catch(t){e(t)}},e.prototype.chmodSync=function(t){if(!this._fs.supportsProps())throw new h(s.ENOTSUP);this._dirty=!0,this._stat.chmod(t),this.syncSync()},e.prototype.isDirty=function(){return this._dirty},e.prototype.resetDirty=function(){this._dirty=!1},e}(K),Q=function(t){function e(e,n,r,i,o){t.call(this,e,n,r,i,o)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.sync=function(t){t()},e.prototype.syncSync=function(){},e.prototype.close=function(t){t()},e.prototype.closeSync=function(){},e}(G),Z=null;function $(){return Z||(Z=Buffer.from("{}"))}function tt(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=16*Math.random()|0;return("x"===t?e:3&e|8).toString(16)})}function et(t,e){return!t||(e(t),!1)}function nt(t,e,n){return!t||(e.abort(function(){n(t)}),!1)}var rt=function(t){this.limit=t,this.size=0,this.map=new Map,this.head=null,this.tail=null};rt.prototype.set=function(t,e){var n=this.map.get(t);n?(n.value=e,this.remove(t,n)):this.size>=this.limit&&(this.map.delete(this.tail.key),this.size--,this.tail=this.tail.prev,this.tail.next=null),this.setHead(n||new function(t,e){this.key=t,this.value=e,this.prev=null,this.next=null}(t,e))},rt.prototype.get=function(t){var e=this.map.get(t);return e?(this.remove(t,e),this.setHead(e),e.value):null},rt.prototype.remove=function(t,e){var n=e||this.map.get(t);n&&(null!==n.prev?n.prev.next=n.next:this.head=n.next,null!==n.next?n.next.prev=n.prev:this.tail=n.prev,this.map.delete(t),this.size--)},rt.prototype.removeAll=function(){this.size=0,this.map=new Map,this.head=null,this.tail=null},rt.prototype.setHead=function(t){t.next=this.head,t.prev=null,null!==this.head&&(this.head.prev=t),this.head=t,null===this.tail&&(this.tail=t),this.size++,this.map.set(t.key,t)};var it=function(t){this.store=t,this.originalData={},this.modifiedKeys=[]};it.prototype.get=function(t){var e=this.store.get(t);return this.stashOldValue(t,e),e},it.prototype.put=function(t,e,n){return this.markModified(t),this.store.put(t,e,n)},it.prototype.del=function(t){this.markModified(t),this.store.del(t)},it.prototype.commit=function(){},it.prototype.abort=function(){for(var t=0,e=this.modifiedKeys;t<e.length;t+=1){var n=e[t],r=this.originalData[n];r?this.store.put(n,r,!0):this.store.del(n)}},it.prototype.stashOldValue=function(t,e){this.originalData.hasOwnProperty(t)||(this.originalData[t]=e)},it.prototype.markModified=function(t){-1===this.modifiedKeys.indexOf(t)&&(this.modifiedKeys.push(t),this.originalData.hasOwnProperty(t)||(this.originalData[t]=this.store.get(t)))};var ot=function(t){function e(e,n,r,i,o){t.call(this,e,n,r,i,o)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.syncSync=function(){this.isDirty()&&(this._fs._syncSync(this.getPath(),this.getBuffer(),this.getStats()),this.resetDirty())},e.prototype.closeSync=function(){this.syncSync()},e}(G),st=function(t){function e(e){t.call(this),this.store=e.store,this.makeRootDirectory()}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.isAvailable=function(){return!0},e.prototype.getName=function(){return this.store.name()},e.prototype.isReadOnly=function(){return!1},e.prototype.supportsSymlinks=function(){return!1},e.prototype.supportsProps=function(){return!1},e.prototype.supportsSynch=function(){return!0},e.prototype.empty=function(){this.store.clear(),this.makeRootDirectory()},e.prototype.renameSync=function(t,e){var n=this.store.beginTransaction("readwrite"),r=a.dirname(t),i=a.basename(t),o=a.dirname(e),c=a.basename(e),u=this.findINode(n,r),f=this.getDirListing(n,r,u);if(!f[i])throw h.ENOENT(t);var p,l,y=f[i];if(delete f[i],0===(o+"/").indexOf(t+"/"))throw new h(s.EBUSY,r);if(o===r?(p=u,l=f):(p=this.findINode(n,o),l=this.getDirListing(n,o,p)),l[c]){var d=this.getINode(n,e,l[c]);if(!d.isFile())throw h.EPERM(e);try{n.del(d.id),n.del(l[c])}catch(t){throw n.abort(),t}}l[c]=y;try{n.put(u.id,Buffer.from(JSON.stringify(f)),!0),n.put(p.id,Buffer.from(JSON.stringify(l)),!0)}catch(t){throw n.abort(),t}n.commit()},e.prototype.statSync=function(t,e){return this.findINode(this.store.beginTransaction("readonly"),t).toStats()},e.prototype.createFileSync=function(t,e,n){var r=this.store.beginTransaction("readwrite"),i=X(),o=this.commitNewFile(r,t,l.FILE,n,i);return new ot(this,t,e,o.toStats(),i)},e.prototype.openFileSync=function(t,e){var n=this.store.beginTransaction("readonly"),r=this.findINode(n,t),i=n.get(r.id);if(void 0===i)throw h.ENOENT(t);return new ot(this,t,e,r.toStats(),i)},e.prototype.unlinkSync=function(t){this.removeEntry(t,!1)},e.prototype.rmdirSync=function(t){if(this.readdirSync(t).length>0)throw h.ENOTEMPTY(t);this.removeEntry(t,!0)},e.prototype.mkdirSync=function(t,e){var n=this.store.beginTransaction("readwrite"),r=Buffer.from("{}");this.commitNewFile(n,t,l.DIRECTORY,e,r)},e.prototype.readdirSync=function(t){var e=this.store.beginTransaction("readonly");return Object.keys(this.getDirListing(e,t,this.findINode(e,t)))},e.prototype._syncSync=function(t,e,n){var r=this.store.beginTransaction("readwrite"),i=this._findINode(r,a.dirname(t),a.basename(t)),o=this.getINode(r,t,i),s=o.update(n);try{r.put(o.id,e,!0),s&&r.put(i,o.toBuffer(),!0)}catch(t){throw r.abort(),t}r.commit()},e.prototype.makeRootDirectory=function(){var t=this.store.beginTransaction("readwrite");if(void 0===t.get("/")){var e=(new Date).getTime(),n=new J(tt(),4096,511|l.DIRECTORY,e,e,e);t.put(n.id,$(),!1),t.put("/",n.toBuffer(),!1),t.commit()}},e.prototype._findINode=function(t,e,n){var r=this,i=function(i){var o=r.getDirListing(t,e,i);if(o[n])return o[n];throw h.ENOENT(a.resolve(e,n))};return"."===e&&(e=process.cwd()),"/"===e?""===n?"/":i(this.getINode(t,e,"/")):i(this.getINode(t,e+a.sep+n,this._findINode(t,a.dirname(e),a.basename(e))))},e.prototype.findINode=function(t,e){return this.getINode(t,e,this._findINode(t,a.dirname(e),a.basename(e)))},e.prototype.getINode=function(t,e,n){var r=t.get(n);if(void 0===r)throw h.ENOENT(e);return J.fromBuffer(r)},e.prototype.getDirListing=function(t,e,n){if(!n.isDirectory())throw h.ENOTDIR(e);var r=t.get(n.id);if(void 0===r)throw h.ENOENT(e);return JSON.parse(r.toString())},e.prototype.addNewNode=function(t,e){for(var n;;)try{return n=tt(),t.put(n,e,!1),n}catch(t){}},e.prototype.commitNewFile=function(t,e,n,r,i){var o,s=a.dirname(e),c=a.basename(e),u=this.findINode(t,s),f=this.getDirListing(t,s,u),p=(new Date).getTime();if("/"===e)throw h.EEXIST(e);if(f[c])throw h.EEXIST(e);try{var l=this.addNewNode(t,i);o=new J(l,i.length,r|n,p,p,p);var y=this.addNewNode(t,o.toBuffer());f[c]=y,t.put(u.id,Buffer.from(JSON.stringify(f)),!0)}catch(e){throw t.abort(),e}return t.commit(),o},e.prototype.removeEntry=function(t,e){var n=this.store.beginTransaction("readwrite"),r=a.dirname(t),i=this.findINode(n,r),o=this.getDirListing(n,r,i),s=a.basename(t);if(!o[s])throw h.ENOENT(t);var c=o[s];delete o[s];var u=this.getINode(n,t,c);if(!e&&u.isDirectory())throw h.EISDIR(t);if(e&&!u.isDirectory())throw h.ENOTDIR(t);try{n.del(u.id),n.del(c),n.put(i.id,Buffer.from(JSON.stringify(o)),!0)}catch(t){throw n.abort(),t}n.commit()},e}(q),ct=function(t){function e(e,n,r,i,o){t.call(this,e,n,r,i,o)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.sync=function(t){var e=this;this.isDirty()?this._fs._sync(this.getPath(),this.getBuffer(),this.getStats(),function(n){n||e.resetDirty(),t(n)}):t()},e.prototype.close=function(t){this.sync(t)},e}(G),at=function(t){function e(e){t.call(this),this._cache=null,e>0&&(this._cache=new rt(e))}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.isAvailable=function(){return!0},e.prototype.init=function(t,e){this.store=t,this.makeRootDirectory(e)},e.prototype.getName=function(){return this.store.name()},e.prototype.isReadOnly=function(){return!1},e.prototype.supportsSymlinks=function(){return!1},e.prototype.supportsProps=function(){return!1},e.prototype.supportsSynch=function(){return!1},e.prototype.empty=function(t){var e=this;this._cache&&this._cache.removeAll(),this.store.clear(function(n){et(n,t)&&e.makeRootDirectory(t)})},e.prototype.rename=function(t,e,n){var r=this;if(this._cache){var i=this._cache;this._cache=null,i.removeAll();var o=n;n=function(t){r._cache=i,o(t)}}var c=this.store.beginTransaction("readwrite"),u=a.dirname(t),f=a.basename(t),p=a.dirname(e),l=a.basename(e),y={},d={},g=!1;if(0===(p+"/").indexOf(t+"/"))return n(new h(s.EBUSY,u));var w=function(i){r.findINodeAndDirListing(c,i,function(o,s,a){o?g||(g=!0,c.abort(function(){n(o)})):(y[i]=s,d[i]=a,function(){if(!g&&d.hasOwnProperty(u)&&d.hasOwnProperty(p)){var i=d[u],o=y[u],s=d[p],a=y[p];if(i[f]){var w=i[f];delete i[f];var m=function(){s[l]=w,c.put(o.id,Buffer.from(JSON.stringify(i)),!0,function(t){nt(t,c,n)&&(u===p?c.commit(n):c.put(a.id,Buffer.from(JSON.stringify(s)),!0,function(t){nt(t,c,n)&&c.commit(n)}))})};s[l]?r.getINode(c,e,s[l],function(t,r){nt(t,c,n)&&(r.isFile()?c.del(r.id,function(t){nt(t,c,n)&&c.del(s[l],function(t){nt(t,c,n)&&m()})}):c.abort(function(t){n(h.EPERM(e))}))}):m()}else n(h.ENOENT(t))}}())})};w(u),u!==p&&w(p)},e.prototype.stat=function(t,e,n){var r=this.store.beginTransaction("readonly");this.findINode(r,t,function(t,e){et(t,n)&&n(null,e.toStats())})},e.prototype.createFile=function(t,e,n,r){var i=this,o=this.store.beginTransaction("readwrite"),s=X();this.commitNewFile(o,t,l.FILE,n,s,function(n,o){et(n,r)&&r(null,new ct(i,t,e,o.toStats(),s))})},e.prototype.openFile=function(t,e,n){var r=this,i=this.store.beginTransaction("readonly");this.findINode(i,t,function(o,s){et(o,n)&&i.get(s.id,function(i,o){et(i,n)&&(void 0===o?n(h.ENOENT(t)):n(null,new ct(r,t,e,s.toStats(),o)))})})},e.prototype.unlink=function(t,e){this.removeEntry(t,!1,e)},e.prototype.rmdir=function(t,e){var n=this;this.readdir(t,function(r,i){r?e(r):i.length>0?e(h.ENOTEMPTY(t)):n.removeEntry(t,!0,e)})},e.prototype.mkdir=function(t,e,n){var r=this.store.beginTransaction("readwrite"),i=Buffer.from("{}");this.commitNewFile(r,t,l.DIRECTORY,e,i,n)},e.prototype.readdir=function(t,e){var n=this,r=this.store.beginTransaction("readonly");this.findINode(r,t,function(i,o){et(i,e)&&n.getDirListing(r,t,o,function(t,n){et(t,e)&&e(null,Object.keys(n))})})},e.prototype._sync=function(t,e,n,r){var i=this,o=this.store.beginTransaction("readwrite");this._findINode(o,a.dirname(t),a.basename(t),function(s,c){nt(s,o,r)&&i.getINode(o,t,c,function(t,i){if(nt(t,o,r)){var s=i.update(n);o.put(i.id,e,!0,function(t){nt(t,o,r)&&(s?o.put(c,i.toBuffer(),!0,function(t){nt(t,o,r)&&o.commit(r)}):o.commit(r))})}})})},e.prototype.makeRootDirectory=function(t){var e=this.store.beginTransaction("readwrite");e.get("/",function(n,r){if(n||void 0===r){var i=(new Date).getTime(),o=new J(tt(),4096,511|l.DIRECTORY,i,i,i);e.put(o.id,$(),!1,function(n){nt(n,e,t)&&e.put("/",o.toBuffer(),!1,function(n){n?e.abort(function(){t(n)}):e.commit(t)})})}else e.commit(t)})},e.prototype._findINode=function(t,e,n,r){var i=this;if(this._cache){var o=this._cache.get(a.join(e,n));if(o)return r(null,o)}var s=function(t,o,s){if(t)r(t);else if(s[n]){var c=s[n];i._cache&&i._cache.set(a.join(e,n),c),r(null,c)}else r(h.ENOENT(a.resolve(e,n)))};"/"===e?""===n?(this._cache&&this._cache.set(a.join(e,n),"/"),r(null,"/")):this.getINode(t,e,"/",function(n,o){et(n,r)&&i.getDirListing(t,e,o,function(t,e){s(t,0,e)})}):this.findINodeAndDirListing(t,e,s)},e.prototype.findINode=function(t,e,n){var r=this;this._findINode(t,a.dirname(e),a.basename(e),function(i,o){et(i,n)&&r.getINode(t,e,o,n)})},e.prototype.getINode=function(t,e,n,r){t.get(n,function(t,n){et(t,r)&&(void 0===n?r(h.ENOENT(e)):r(null,J.fromBuffer(n)))})},e.prototype.getDirListing=function(t,e,n,r){n.isDirectory()?t.get(n.id,function(t,n){if(et(t,r))try{r(null,JSON.parse(n.toString()))}catch(t){r(h.ENOENT(e))}}):r(h.ENOTDIR(e))},e.prototype.findINodeAndDirListing=function(t,e,n){var r=this;this.findINode(t,e,function(i,o){et(i,n)&&r.getDirListing(t,e,o,function(t,e){et(t,n)&&n(null,o,e)})})},e.prototype.addNewNode=function(t,e,n){var r,i=0,o=function(){5==++i?n(new h(s.EIO,"Unable to commit data to key-value store.")):(r=tt(),t.put(r,e,!1,function(t,e){t||!e?o():n(null,r)}))};o()},e.prototype.commitNewFile=function(t,e,n,r,i,o){var s=this,c=a.dirname(e),u=a.basename(e),f=(new Date).getTime();if("/"===e)return o(h.EEXIST(e));this.findINodeAndDirListing(t,c,function(c,a,p){nt(c,t,o)&&(p[u]?t.abort(function(){o(h.EEXIST(e))}):s.addNewNode(t,i,function(e,c){if(nt(e,t,o)){var h=new J(c,i.length,r|n,f,f,f);s.addNewNode(t,h.toBuffer(),function(e,n){nt(e,t,o)&&(p[u]=n,t.put(a.id,Buffer.from(JSON.stringify(p)),!0,function(e){nt(e,t,o)&&t.commit(function(e){nt(e,t,o)&&o(null,h)})}))})}}))})},e.prototype.removeEntry=function(t,e,n){var r=this;this._cache&&this._cache.remove(t);var i=this.store.beginTransaction("readwrite"),o=a.dirname(t),s=a.basename(t);this.findINodeAndDirListing(i,o,function(o,c,a){if(nt(o,i,n))if(a[s]){var u=a[s];delete a[s],r.getINode(i,t,u,function(r,o){nt(r,i,n)&&(!e&&o.isDirectory()?i.abort(function(){n(h.EISDIR(t))}):e&&!o.isDirectory()?i.abort(function(){n(h.ENOTDIR(t))}):i.del(o.id,function(t){nt(t,i,n)&&i.del(u,function(t){nt(t,i,n)&&i.put(c.id,Buffer.from(JSON.stringify(a)),!0,function(t){nt(t,i,n)&&i.commit(n)})})}))})}else i.abort(function(){n(h.ENOENT(t))})})},e}(H),ut=function(){this.store={}};ut.prototype.name=function(){return ft.Name},ut.prototype.clear=function(){this.store={}},ut.prototype.beginTransaction=function(t){return new it(this)},ut.prototype.get=function(t){return this.store[t]},ut.prototype.put=function(t,e,n){return!(!n&&this.store.hasOwnProperty(t))&&(this.store[t]=e,!0)},ut.prototype.del=function(t){delete this.store[t]};var ft=function(t){function e(){t.call(this,{store:new ut})}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.Create=function(t,n){n(null,new e)},e}(st);ft.Name="InMemory",ft.Options={};var ht=function(){try{return m.indexedDB||m.mozIndexedDB||m.webkitIndexedDB||m.msIndexedDB}catch(t){return null}}();function pt(t,e){switch(void 0===e&&(e=t.toString()),t.name){case"NotFoundError":return new h(s.ENOENT,e);case"QuotaExceededError":return new h(s.ENOSPC,e);default:return new h(s.EIO,e)}}function lt(t,e,n){return void 0===e&&(e=s.EIO),void 0===n&&(n=null),function(r){r.preventDefault(),t(new h(e,null!==n?n:void 0))}}var yt=function(t,e){this.tx=t,this.store=e};yt.prototype.get=function(t,e){try{var n=this.store.get(t);n.onerror=lt(e),n.onsuccess=function(t){var n=t.target.result;e(null,void 0===n?n:j(n))}}catch(t){e(pt(t))}};var dt=function(t){function e(e,n){t.call(this,e,n)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.put=function(t,e,n,r){try{var i,o=M(e);(i=n?this.store.put(o,t):this.store.add(o,t)).onerror=lt(r),i.onsuccess=function(t){r(null,!0)}}catch(t){r(pt(t))}},e.prototype.del=function(t,e){try{var n=this.store.delete(t);n.onerror=lt(e),n.onsuccess=function(t){e()}}catch(t){e(pt(t))}},e.prototype.commit=function(t){setTimeout(t,0)},e.prototype.abort=function(t){var e=null;try{this.tx.abort()}catch(t){e=pt(t)}finally{t(e)}},e}(yt),gt=function(t,e){this.db=t,this.storeName=e};gt.Create=function(t,e){var n=ht.open(t,1);n.onupgradeneeded=function(e){var n=e.target.result;n.objectStoreNames.contains(t)&&n.deleteObjectStore(t),n.createObjectStore(t)},n.onsuccess=function(n){e(null,new gt(n.target.result,t))},n.onerror=lt(e,s.EACCES)},gt.prototype.name=function(){return wt.Name+" - "+this.storeName},gt.prototype.clear=function(t){try{var e=this.db.transaction(this.storeName,"readwrite").objectStore(this.storeName).clear();e.onsuccess=function(e){setTimeout(t,0)},e.onerror=lt(t)}catch(e){t(pt(e))}},gt.prototype.beginTransaction=function(t){void 0===t&&(t="readonly");var e=this.db.transaction(this.storeName,t),n=e.objectStore(this.storeName);if("readwrite"===t)return new dt(e,n);if("readonly"===t)return new yt(e,n);throw new h(s.EINVAL,"Invalid transaction type.")};var wt=function(t){function e(e){t.call(this,e)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.Create=function(t,n){void 0===t&&(t={}),gt.Create(t.storeName?t.storeName:"browserfs",function(r,i){if(i){var o=new e("number"==typeof t.cacheSize?t.cacheSize:100);o.init(i,function(t){t?n(t):n(null,o)})}else n(r)})},e.isAvailable=function(){try{return void 0!==ht&&null!==ht.open("__browserfs_test__")}catch(t){return!1}},e}(at);wt.Name="IndexedDB",wt.Options={storeName:{type:"string",optional:!0,description:"The name of this file system. You can have multiple IndexedDB file systems operating at once, but each must have a different name."},cacheSize:{type:"number",optional:!0,description:"The size of the inode cache. Defaults to 100. A size of 0 or below disables caching."}};var mt=function(t){function e(e){t.call(this),this.mountList=[],this.mntMap={},this.rootFs=e}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.Create=function(t,n){ft.Create({},function(r,i){if(i){var o=new e(i);try{Object.keys(t).forEach(function(e){o.mount(e,t[e])})}catch(r){return n(r)}n(null,o)}else n(r)})},e.isAvailable=function(){return!0},e.prototype.mount=function(t,e){if("/"!==t[0]&&(t="/"+t),t=a.resolve(t),this.mntMap[t])throw new h(s.EINVAL,"Mount point "+t+" is already taken.");U(t,511,this.rootFs),this.mntMap[t]=e,this.mountList.push(t),this.mountList=this.mountList.sort(function(t,e){return e.length-t.length})},e.prototype.umount=function(t){if("/"!==t[0]&&(t="/"+t),t=a.resolve(t),!this.mntMap[t])throw new h(s.EINVAL,"Mount point "+t+" is already unmounted.");for(delete this.mntMap[t],this.mountList.splice(this.mountList.indexOf(t),1);"/"!==t&&0===this.rootFs.readdirSync(t).length;)this.rootFs.rmdirSync(t),t=a.dirname(t)},e.prototype._getFs=function(t){for(var e=this.mountList,n=e.length,r=0;r<n;r++){var i=e[r];if(i.length<=t.length&&(t===i||t.startsWith(i.endsWith("/")?i:i+"/")))return""===(t=t.substr(i.length>1?i.length:0))&&(t="/"),{fs:this.mntMap[i],path:t,mountPoint:i}}return{fs:this.rootFs,path:t,mountPoint:"/"}},e.prototype.getName=function(){return e.Name},e.prototype.diskSpace=function(t,e){e(0,0)},e.prototype.isReadOnly=function(){return!1},e.prototype.supportsLinks=function(){return!1},e.prototype.supportsProps=function(){return!1},e.prototype.supportsSynch=function(){return!0},e.prototype.standardizeError=function(t,e,n){var r=t.message.indexOf(e);return-1!==r&&(t.message=t.message.substr(0,r)+n+t.message.substr(r+e.length),t.path=n),t},e.prototype.rename=function(t,e,n){var r=this,i=this._getFs(t),o=this._getFs(e);return i.fs===o.fs?i.fs.rename(i.path,o.path,function(s){s&&r.standardizeError(r.standardizeError(s,i.path,t),o.path,e),n(s)}):D.readFile(t,function(r,i){if(r)return n(r);D.writeFile(e,i,function(e){if(e)return n(e);D.unlink(t,n)})})},e.prototype.renameSync=function(t,e){var n=this._getFs(t),r=this._getFs(e);if(n.fs===r.fs)try{return n.fs.renameSync(n.path,r.path)}catch(i){throw this.standardizeError(this.standardizeError(i,n.path,t),r.path,e),i}var i=D.readFileSync(t);return D.writeFileSync(e,i),D.unlinkSync(t)},e.prototype.readdirSync=function(t){var e=this._getFs(t),n=null;if(e.fs!==this.rootFs)try{n=this.rootFs.readdirSync(t)}catch(t){}try{var r=e.fs.readdirSync(e.path);return null===n?r:r.concat(n.filter(function(t){return-1===r.indexOf(t)}))}catch(r){if(null===n)throw this.standardizeError(r,e.path,t);return n}},e.prototype.readdir=function(t,e){var n=this,r=this._getFs(t);r.fs.readdir(r.path,function(i,o){if(r.fs!==n.rootFs)try{var s=n.rootFs.readdirSync(t);o=o?o.concat(s.filter(function(t){return-1===o.indexOf(t)})):s}catch(o){if(i)return e(n.standardizeError(i,r.path,t))}else if(i)return e(n.standardizeError(i,r.path,t));e(null,o)})},e.prototype.realpathSync=function(t,e){var n=this._getFs(t);try{var r=n.fs.realpathSync(n.path,{});return a.resolve(a.join(n.mountPoint,r))}catch(e){throw this.standardizeError(e,n.path,t)}},e.prototype.realpath=function(t,e,n){var r=this,i=this._getFs(t);i.fs.realpath(i.path,{},function(e,o){e?n(r.standardizeError(e,i.path,t)):n(null,a.resolve(a.join(i.mountPoint,o)))})},e.prototype.rmdirSync=function(t){var e=this._getFs(t);if(this._containsMountPt(t))throw h.ENOTEMPTY(t);try{e.fs.rmdirSync(e.path)}catch(n){throw this.standardizeError(n,e.path,t)}},e.prototype.rmdir=function(t,e){var n=this,r=this._getFs(t);this._containsMountPt(t)?e(h.ENOTEMPTY(t)):r.fs.rmdir(r.path,function(i){e(i?n.standardizeError(i,r.path,t):null)})},e.prototype._containsMountPt=function(t){for(var e=this.mountList,n=e.length,r=0;r<n;r++){var i=e[r];if(i.length>=t.length&&i.slice(0,t.length)===t)return!0}return!1},e}(H);function vt(t,e,n){return e?function(){for(var e=[],n=arguments.length;n--;)e[n]=arguments[n];var r=e[0],i=this._getFs(r);e[0]=i.path;try{return i.fs[t].apply(i.fs,e)}catch(t){throw this.standardizeError(t,i.path,r),t}}:function(){for(var e=this,n=[],r=arguments.length;r--;)n[r]=arguments[r];var i=n[0],o=this._getFs(i);if(n[0]=o.path,"function"==typeof n[n.length-1]){var s=n[n.length-1];n[n.length-1]=function(){for(var t=[],n=arguments.length;n--;)t[n]=arguments[n];t.length>0&&t[0]instanceof h&&e.standardizeError(t[0],o.path,i),s.apply(null,t)}}return o.fs[t].apply(o.fs,n)}}mt.Name="MountableFileSystem",mt.Options={};for(var Et=[["exists","unlink","readlink"],["stat","mkdir","truncate"],["open","readFile","chmod","utimes"],["chown"],["writeFile","appendFile"]],St=0;St<Et.length;St++)for(var _t=0,bt=Et[St];_t<bt.length;_t+=1){var Nt=bt[_t];mt.prototype[Nt]=vt(Nt,!1),mt.prototype[Nt+"Sync"]=vt(Nt+"Sync",!0)}var It=function(){this._locked=!1,this._waiters=[]};It.prototype.lock=function(t){this._locked?this._waiters.push(t):(this._locked=!0,t())},It.prototype.unlock=function(){if(!this._locked)throw new Error("unlock of a non-locked mutex");var t=this._waiters.shift();t?b(t):this._locked=!1},It.prototype.tryLock=function(){return!this._locked&&(this._locked=!0,!0)},It.prototype.isLocked=function(){return this._locked};var Tt=function(t){this._fs=t,this._mu=new It};Tt.prototype.getName=function(){return"LockedFS<"+this._fs.getName()+">"},Tt.prototype.getFSUnlocked=function(){return this._fs},Tt.prototype.diskSpace=function(t,e){this._fs.diskSpace(t,e)},Tt.prototype.isReadOnly=function(){return this._fs.isReadOnly()},Tt.prototype.supportsLinks=function(){return this._fs.supportsLinks()},Tt.prototype.supportsProps=function(){return this._fs.supportsProps()},Tt.prototype.supportsSynch=function(){return this._fs.supportsSynch()},Tt.prototype.rename=function(t,e,n){var r=this;this._mu.lock(function(){r._fs.rename(t,e,function(t){r._mu.unlock(),n(t)})})},Tt.prototype.renameSync=function(t,e){if(this._mu.isLocked())throw new Error("invalid sync call");return this._fs.renameSync(t,e)},Tt.prototype.stat=function(t,e,n){var r=this;this._mu.lock(function(){r._fs.stat(t,e,function(t,e){r._mu.unlock(),n(t,e)})})},Tt.prototype.statSync=function(t,e){if(this._mu.isLocked())throw new Error("invalid sync call");return this._fs.statSync(t,e)},Tt.prototype.open=function(t,e,n,r){var i=this;this._mu.lock(function(){i._fs.open(t,e,n,function(t,e){i._mu.unlock(),r(t,e)})})},Tt.prototype.openSync=function(t,e,n){if(this._mu.isLocked())throw new Error("invalid sync call");return this._fs.openSync(t,e,n)},Tt.prototype.unlink=function(t,e){var n=this;this._mu.lock(function(){n._fs.unlink(t,function(t){n._mu.unlock(),e(t)})})},Tt.prototype.unlinkSync=function(t){if(this._mu.isLocked())throw new Error("invalid sync call");return this._fs.unlinkSync(t)},Tt.prototype.rmdir=function(t,e){var n=this;this._mu.lock(function(){n._fs.rmdir(t,function(t){n._mu.unlock(),e(t)})})},Tt.prototype.rmdirSync=function(t){if(this._mu.isLocked())throw new Error("invalid sync call");return this._fs.rmdirSync(t)},Tt.prototype.mkdir=function(t,e,n){var r=this;this._mu.lock(function(){r._fs.mkdir(t,e,function(t){r._mu.unlock(),n(t)})})},Tt.prototype.mkdirSync=function(t,e){if(this._mu.isLocked())throw new Error("invalid sync call");return this._fs.mkdirSync(t,e)},Tt.prototype.readdir=function(t,e){var n=this;this._mu.lock(function(){n._fs.readdir(t,function(t,r){n._mu.unlock(),e(t,r)})})},Tt.prototype.readdirSync=function(t){if(this._mu.isLocked())throw new Error("invalid sync call");return this._fs.readdirSync(t)},Tt.prototype.exists=function(t,e){var n=this;this._mu.lock(function(){n._fs.exists(t,function(t){n._mu.unlock(),e(t)})})},Tt.prototype.existsSync=function(t){if(this._mu.isLocked())throw new Error("invalid sync call");return this._fs.existsSync(t)},Tt.prototype.realpath=function(t,e,n){var r=this;this._mu.lock(function(){r._fs.realpath(t,e,function(t,e){r._mu.unlock(),n(t,e)})})},Tt.prototype.realpathSync=function(t,e){if(this._mu.isLocked())throw new Error("invalid sync call");return this._fs.realpathSync(t,e)},Tt.prototype.truncate=function(t,e,n){var r=this;this._mu.lock(function(){r._fs.truncate(t,e,function(t){r._mu.unlock(),n(t)})})},Tt.prototype.truncateSync=function(t,e){if(this._mu.isLocked())throw new Error("invalid sync call");return this._fs.truncateSync(t,e)},Tt.prototype.readFile=function(t,e,n,r){var i=this;this._mu.lock(function(){i._fs.readFile(t,e,n,function(t,e){i._mu.unlock(),r(t,e)})})},Tt.prototype.readFileSync=function(t,e,n){if(this._mu.isLocked())throw new Error("invalid sync call");return this._fs.readFileSync(t,e,n)},Tt.prototype.writeFile=function(t,e,n,r,i,o){var s=this;this._mu.lock(function(){s._fs.writeFile(t,e,n,r,i,function(t){s._mu.unlock(),o(t)})})},Tt.prototype.writeFileSync=function(t,e,n,r,i){if(this._mu.isLocked())throw new Error("invalid sync call");return this._fs.writeFileSync(t,e,n,r,i)},Tt.prototype.appendFile=function(t,e,n,r,i,o){var s=this;this._mu.lock(function(){s._fs.appendFile(t,e,n,r,i,function(t){s._mu.unlock(),o(t)})})},Tt.prototype.appendFileSync=function(t,e,n,r,i){if(this._mu.isLocked())throw new Error("invalid sync call");return this._fs.appendFileSync(t,e,n,r,i)},Tt.prototype.chmod=function(t,e,n,r){var i=this;this._mu.lock(function(){i._fs.chmod(t,e,n,function(t){i._mu.unlock(),r(t)})})},Tt.prototype.chmodSync=function(t,e,n){if(this._mu.isLocked())throw new Error("invalid sync call");return this._fs.chmodSync(t,e,n)},Tt.prototype.chown=function(t,e,n,r,i){var o=this;this._mu.lock(function(){o._fs.chown(t,e,n,r,function(t){o._mu.unlock(),i(t)})})},Tt.prototype.chownSync=function(t,e,n,r){if(this._mu.isLocked())throw new Error("invalid sync call");return this._fs.chownSync(t,e,n,r)},Tt.prototype.utimes=function(t,e,n,r){var i=this;this._mu.lock(function(){i._fs.utimes(t,e,n,function(t){i._mu.unlock(),r(t)})})},Tt.prototype.utimesSync=function(t,e,n){if(this._mu.isLocked())throw new Error("invalid sync call");return this._fs.utimesSync(t,e,n)},Tt.prototype.link=function(t,e,n){var r=this;this._mu.lock(function(){r._fs.link(t,e,function(t){r._mu.unlock(),n(t)})})},Tt.prototype.linkSync=function(t,e){if(this._mu.isLocked())throw new Error("invalid sync call");return this._fs.linkSync(t,e)},Tt.prototype.symlink=function(t,e,n,r){var i=this;this._mu.lock(function(){i._fs.symlink(t,e,n,function(t){i._mu.unlock(),r(t)})})},Tt.prototype.symlinkSync=function(t,e,n){if(this._mu.isLocked())throw new Error("invalid sync call");return this._fs.symlinkSync(t,e,n)},Tt.prototype.readlink=function(t,e){var n=this;this._mu.lock(function(){n._fs.readlink(t,function(t,r){n._mu.unlock(),e(t,r)})})},Tt.prototype.readlinkSync=function(t){if(this._mu.isLocked())throw new Error("invalid sync call");return this._fs.readlinkSync(t)};var Ot="/.deletedFiles.log";function Ft(t){return 146|t}function Pt(t){return y.getFileFlag(t)}var kt=function(t){function e(e,n,r,i,o){t.call(this,e,n,r,i,o)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.sync=function(t){var e=this;this.isDirty()?this._fs._syncAsync(this,function(n){e.resetDirty(),t(n)}):t(null)},e.prototype.syncSync=function(){this.isDirty()&&(this._fs._syncSync(this),this.resetDirty())},e.prototype.close=function(t){this.sync(t)},e.prototype.closeSync=function(){this.syncSync()},e}(G),At=function(t){function e(e,n){if(t.call(this),this._isInitialized=!1,this._initializeCallbacks=[],this._deletedFiles={},this._deleteLog="",this._deleteLogUpdatePending=!1,this._deleteLogUpdateNeeded=!1,this._deleteLogError=null,this._writable=e,this._readable=n,this._writable.isReadOnly())throw new h(s.EINVAL,"Writable file system must be writable.")}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.isAvailable=function(){return!0},e.prototype.getOverlayedFileSystems=function(){return{readable:this._readable,writable:this._writable}},e.prototype._syncAsync=function(t,e){var n=this;this.createParentDirectoriesAsync(t.getPath(),function(r){if(r)return e(r);n._writable.writeFile(t.getPath(),t.getBuffer(),null,Pt("w"),t.getStats().mode,e)})},e.prototype._syncSync=function(t){this.createParentDirectories(t.getPath()),this._writable.writeFileSync(t.getPath(),t.getBuffer(),null,Pt("w"),t.getStats().mode)},e.prototype.getName=function(){return Lt.Name},e.prototype._initialize=function(t){var e=this,n=this._initializeCallbacks,r=function(t){e._isInitialized=!t,e._initializeCallbacks=[],n.forEach(function(e){return e(t)})};if(this._isInitialized)return t();n.push(t),1===n.length&&this._writable.readFile(Ot,"utf8",Pt("r"),function(t,n){if(t){if(t.errno!==s.ENOENT)return r(t)}else e._deleteLog=n;e._reparseDeletionLog(),r()})},e.prototype.isReadOnly=function(){return!1},e.prototype.supportsSynch=function(){return this._readable.supportsSynch()&&this._writable.supportsSynch()},e.prototype.supportsLinks=function(){return!1},e.prototype.supportsProps=function(){return this._readable.supportsProps()&&this._writable.supportsProps()},e.prototype.getDeletionLog=function(){return this._deleteLog},e.prototype.restoreDeletionLog=function(t){this._deleteLog=t,this._reparseDeletionLog(),this.updateLog("")},e.prototype.rename=function(t,e,n){var r=this;if(this.checkInitAsync(n)&&!this.checkPathAsync(t,n)&&!this.checkPathAsync(e,n))return t===Ot||e===Ot?n(h.EPERM("Cannot rename deletion log.")):t===e?n():void this.stat(t,!1,function(i,o){return i?n(i):r.stat(e,!1,function(i,c){var u=r;function f(r){var i=r.shift();if(!i)return n();var o=a.resolve(t,i),s=a.resolve(e,i);u.rename(o,s,function(t){if(t)return n(t);f(r)})}var p=511;if(o.isDirectory()){if(i)return i.errno!==s.ENOENT?n(i):r._writable.exists(t,function(i){if(i)return r.createParentDirectoriesAsync(e,function(i){return i?n(i):r._writable.rename(t,e,n)});r.createParentDirectoriesAsync(e,function(i){if(i)return n(i);r._writable.mkdir(e,p,function(e){if(e)return n(e);r.readdir(t,function(e,i){if(e)return n(e);f(i),r.deletePath(t)})})})});if(p=c.mode,!c.isDirectory())return n(h.ENOTDIR(e));r.readdir(e,function(i,o){if(o&&o.length)return n(h.ENOTEMPTY(e));r._readable.readdir(t,function(e,i){if(e)return n(e);f(i),r.deletePath(t)})})}if(c&&c.isDirectory())return n(h.EISDIR(e));r.readFile(t,null,Pt("r"),function(i,s){return i?n(i):r.writeFile(e,s,null,Pt("w"),o.mode,function(e){return e?n(e):r.unlink(t,n)})})})})},e.prototype.renameSync=function(t,e){var n=this;if(this.checkInitialized(),this.checkPath(t),this.checkPath(e),t===Ot||e===Ot)throw h.EPERM("Cannot rename deletion log.");var r=this.statSync(t,!1);if(r.isDirectory()){if(t===e)return;var i=511;if(this.existsSync(e)){var o=this.statSync(e,!1);if(i=o.mode,!o.isDirectory())throw h.ENOTDIR(e);if(this.readdirSync(e).length>0)throw h.ENOTEMPTY(e)}this._writable.existsSync(t)?this._writable.renameSync(t,e):this._writable.existsSync(e)||(this.createParentDirectories(e),this._writable.mkdirSync(e,i)),this._readable.existsSync(t)&&(this._readable.readdirSync(t).forEach(function(r){n.renameSync(a.resolve(t,r),a.resolve(e,r))}),this.deletePath(t))}else{if(this.existsSync(e)&&this.statSync(e,!1).isDirectory())throw h.EISDIR(e);this.writeFileSync(e,this.readFileSync(t,null,Pt("r")),null,Pt("w"),r.mode)}t!==e&&this.existsSync(t)&&this.unlinkSync(t)},e.prototype.stat=function(t,e,n){var r=this;this.checkInitAsync(n)&&this._writable.stat(t,e,function(i,o){if(i&&i.errno===s.ENOENT){if(r._deletedFiles[t])return n(h.ENOENT(t));r._readable.stat(t,e,function(t,e){e&&((e=d.clone(e)).mode=Ft(e.mode)),n(t,e)})}else n(i,o)})},e.prototype.statSync=function(t,e){this.checkInitialized();try{return this._writable.statSync(t,e)}catch(r){if(this._deletedFiles[t])throw h.ENOENT(t);var n=d.clone(this._readable.statSync(t,e));return n.mode=Ft(n.mode),n}},e.prototype.open=function(t,e,n,r){var i=this;this.checkInitAsync(r)&&!this.checkPathAsync(t,r)&&this.stat(t,!0,function(o,s){if(s)switch(e.pathExistsAction()){case f.TRUNCATE_FILE:return i.createParentDirectoriesAsync(t,function(o){if(o)return r(o);i._writable.open(t,e,n,r)});case f.NOP:return i._writable.exists(t,function(o){o?i._writable.open(t,e,n,r):((s=d.clone(s)).mode=n,i._readable.readFile(t,null,Pt("r"),function(n,o){if(n)return r(n);-1===s.size&&(s.size=o.length);var c=new kt(i,t,e,s,o);r(null,c)}))});default:return r(h.EEXIST(t))}else switch(e.pathNotExistsAction()){case f.CREATE_FILE:return i.createParentDirectoriesAsync(t,function(o){return o?r(o):i._writable.open(t,e,n,r)});default:return r(h.ENOENT(t))}})},e.prototype.openSync=function(t,e,n){if(this.checkInitialized(),this.checkPath(t),t===Ot)throw h.EPERM("Cannot open deletion log.");if(this.existsSync(t))switch(e.pathExistsAction()){case f.TRUNCATE_FILE:return this.createParentDirectories(t),this._writable.openSync(t,e,n);case f.NOP:if(this._writable.existsSync(t))return this._writable.openSync(t,e,n);var r=this._readable.readFileSync(t,null,Pt("r")),i=d.clone(this._readable.statSync(t,!1));return i.mode=n,new kt(this,t,e,i,r);default:throw h.EEXIST(t)}else switch(e.pathNotExistsAction()){case f.CREATE_FILE:return this.createParentDirectories(t),this._writable.openSync(t,e,n);default:throw h.ENOENT(t)}},e.prototype.unlink=function(t,e){var n=this;this.checkInitAsync(e)&&!this.checkPathAsync(t,e)&&this.exists(t,function(r){if(!r)return e(h.ENOENT(t));n._writable.exists(t,function(r){if(r)return n._writable.unlink(t,function(r){if(r)return e(r);n.exists(t,function(r){r&&n.deletePath(t),e(null)})});n.deletePath(t),e(null)})})},e.prototype.unlinkSync=function(t){if(this.checkInitialized(),this.checkPath(t),!this.existsSync(t))throw h.ENOENT(t);this._writable.existsSync(t)&&this._writable.unlinkSync(t),this.existsSync(t)&&this.deletePath(t)},e.prototype.rmdir=function(t,e){var n=this;if(this.checkInitAsync(e)){var r=function(){n.readdir(t,function(r,i){return r?e(r):i.length?e(h.ENOTEMPTY(t)):(n.deletePath(t),void e(null))})};this.exists(t,function(i){if(!i)return e(h.ENOENT(t));n._writable.exists(t,function(i){i?n._writable.rmdir(t,function(i){if(i)return e(i);n._readable.exists(t,function(t){t?r():e()})}):r()})})}},e.prototype.rmdirSync=function(t){if(this.checkInitialized(),!this.existsSync(t))throw h.ENOENT(t);if(this._writable.existsSync(t)&&this._writable.rmdirSync(t),this.existsSync(t)){if(this.readdirSync(t).length>0)throw h.ENOTEMPTY(t);this.deletePath(t)}},e.prototype.mkdir=function(t,e,n){var r=this;this.checkInitAsync(n)&&this.exists(t,function(i){if(i)return n(h.EEXIST(t));r.createParentDirectoriesAsync(t,function(i){if(i)return n(i);r._writable.mkdir(t,e,n)})})},e.prototype.mkdirSync=function(t,e){if(this.checkInitialized(),this.existsSync(t))throw h.EEXIST(t);this.createParentDirectories(t),this._writable.mkdirSync(t,e)},e.prototype.readdir=function(t,e){var n=this;this.checkInitAsync(e)&&this.stat(t,!0,function(r,i){return r?e(r):i.isDirectory()?void n._writable.readdir(t,function(r,i){if(r&&"ENOENT"!==r.code)return e(r);!r&&i||(i=[]),n._readable.readdir(t,function(r,o){!r&&o||(o=[]);var s={},c=i.concat(o.filter(function(e){return!n._deletedFiles[t+("/"===t?"":"/")+e]})).filter(function(t){var e=!s[t];return s[t]=!0,e});e(null,c)})}):e(h.ENOTDIR(t))})},e.prototype.readdirSync=function(t){var e=this;if(this.checkInitialized(),!this.statSync(t,!1).isDirectory())throw h.ENOTDIR(t);var n=[];try{n=n.concat(this._writable.readdirSync(t))}catch(t){}try{n=n.concat(this._readable.readdirSync(t).filter(function(n){return!e._deletedFiles[t+("/"===t?"":"/")+n]}))}catch(t){}var r={};return n.filter(function(t){var e=!r[t];return r[t]=!0,e})},e.prototype.exists=function(t,e){var n=this;this.checkInitialized(),this._writable.exists(t,function(r){if(r)return e(!0);n._readable.exists(t,function(r){e(r&&!0!==n._deletedFiles[t])})})},e.prototype.existsSync=function(t){return this.checkInitialized(),this._writable.existsSync(t)||this._readable.existsSync(t)&&!0!==this._deletedFiles[t]},e.prototype.chmod=function(t,e,n,r){var i=this;this.checkInitAsync(r)&&this.operateOnWritableAsync(t,function(o){if(o)return r(o);i._writable.chmod(t,e,n,r)})},e.prototype.chmodSync=function(t,e,n){var r=this;this.checkInitialized(),this.operateOnWritable(t,function(){r._writable.chmodSync(t,e,n)})},e.prototype.chown=function(t,e,n,r,i){var o=this;this.checkInitAsync(i)&&this.operateOnWritableAsync(t,function(s){if(s)return i(s);o._writable.chown(t,e,n,r,i)})},e.prototype.chownSync=function(t,e,n,r){var i=this;this.checkInitialized(),this.operateOnWritable(t,function(){i._writable.chownSync(t,e,n,r)})},e.prototype.utimes=function(t,e,n,r){var i=this;this.checkInitAsync(r)&&this.operateOnWritableAsync(t,function(o){if(o)return r(o);i._writable.utimes(t,e,n,r)})},e.prototype.utimesSync=function(t,e,n){var r=this;this.checkInitialized(),this.operateOnWritable(t,function(){r._writable.utimesSync(t,e,n)})},e.prototype.deletePath=function(t){this._deletedFiles[t]=!0,this.updateLog("d"+t+"\n")},e.prototype.updateLog=function(t){var e=this;this._deleteLog+=t,this._deleteLogUpdatePending?this._deleteLogUpdateNeeded=!0:(this._deleteLogUpdatePending=!0,this._writable.writeFile(Ot,this._deleteLog,"utf8",y.getFileFlag("w"),420,function(t){e._deleteLogUpdatePending=!1,t?e._deleteLogError=t:e._deleteLogUpdateNeeded&&(e._deleteLogUpdateNeeded=!1,e.updateLog(""))}))},e.prototype._reparseDeletionLog=function(){var t=this;this._deletedFiles={},this._deleteLog.split("\n").forEach(function(e){t._deletedFiles[e.slice(1)]="d"===e.slice(0,1)})},e.prototype.checkInitialized=function(){if(!this._isInitialized)throw new h(s.EPERM,"OverlayFS is not initialized. Please initialize OverlayFS using its initialize() method before using it.");if(null!==this._deleteLogError){var t=this._deleteLogError;throw this._deleteLogError=null,t}},e.prototype.checkInitAsync=function(t){if(!this._isInitialized)return t(new h(s.EPERM,"OverlayFS is not initialized. Please initialize OverlayFS using its initialize() method before using it.")),!1;if(null!==this._deleteLogError){var e=this._deleteLogError;return this._deleteLogError=null,t(e),!1}return!0},e.prototype.checkPath=function(t){if(t===Ot)throw h.EPERM(t)},e.prototype.checkPathAsync=function(t,e){return t===Ot&&(e(h.EPERM(t)),!0)},e.prototype.createParentDirectoriesAsync=function(t,e){var n=a.dirname(t),r=[],i=this;this._writable.stat(n,!1,function t(o,c){o?"/"===n?e(new h(s.EBUSY,"Invariant failed: root does not exist!")):(r.push(n),n=a.dirname(n),i._writable.stat(n,!1,t)):function t(){if(!r.length)return e();var n=r.pop();i._readable.stat(n,!1,function(r,o){if(!o)return e();i._writable.mkdir(n,o.mode,function(n){if(n)return e(n);t()})})}()})},e.prototype.createParentDirectories=function(t){for(var e=this,n=a.dirname(t),r=[];!this._writable.existsSync(n);)r.push(n),n=a.dirname(n);(r=r.reverse()).forEach(function(t){e._writable.mkdirSync(t,e.statSync(t,!1).mode)})},e.prototype.operateOnWritable=function(t,e){if(!this.existsSync(t))throw h.ENOENT(t);this._writable.existsSync(t)||this.copyToWritable(t),e()},e.prototype.operateOnWritableAsync=function(t,e){var n=this;this.exists(t,function(r){if(!r)return e(h.ENOENT(t));n._writable.exists(t,function(r){if(!r)return n.copyToWritableAsync(t,e);e()})})},e.prototype.copyToWritable=function(t){var e=this.statSync(t,!1);e.isDirectory()?this._writable.mkdirSync(t,e.mode):this.writeFileSync(t,this._readable.readFileSync(t,null,Pt("r")),null,Pt("w"),this.statSync(t,!1).mode)},e.prototype.copyToWritableAsync=function(t,e){var n=this;this.stat(t,!1,function(r,i){return r?e(r):i.isDirectory()?n._writable.mkdir(t,i.mode,e):void n._readable.readFile(t,null,Pt("r"),function(r,o){if(r)return e(r);n.writeFile(t,o,null,Pt("w"),i.mode,e)})})},e}(H),Lt=function(t){function e(e,n){t.call(this,new At(e,n))}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.Create=function(t,n){try{var r=new e(t.writable,t.readable);r._initialize(function(t){n(t,r)})}catch(t){n(t)}},e.isAvailable=function(){return At.isAvailable()},e.prototype.getOverlayedFileSystems=function(){return t.prototype.getFSUnlocked.call(this).getOverlayedFileSystems()},e.prototype.unwrap=function(){return t.prototype.getFSUnlocked.call(this)},e.prototype._initialize=function(e){t.prototype.getFSUnlocked.call(this)._initialize(e)},e}(Tt);Lt.Name="OverlayFS",Lt.Options={writable:{type:"object",description:"The file system to write modified files to."},readable:{type:"object",description:"The file system that initially populates this file system."}};var Rt=function(t,e,n){var r=new XMLHttpRequest;r.open("GET",t,!0);var i=!0;switch(e){case"buffer":r.responseType="arraybuffer";break;case"json":try{r.responseType="json",i="json"===r.responseType}catch(t){i=!1}break;default:return n(new h(s.EINVAL,"Invalid download type: "+e))}r.onreadystatechange=function(t){if(4===r.readyState){if(200!==r.status)return n(new h(s.EIO,"XHR error: response returned code "+r.status));switch(e){case"buffer":return n(null,r.response?Buffer.from(r.response):X());case"json":return n(null,i?r.response:JSON.parse(r.responseText))}}},r.send()},Dt=function(t,e){var n=new XMLHttpRequest;n.open("GET",t,!1);var r=null,i=null;if(n.overrideMimeType("text/plain; charset=x-user-defined"),n.onreadystatechange=function(t){if(4===n.readyState){if(200!==n.status)return void(i=new h(s.EIO,"XHR error: response returned code "+n.status));switch(e){case"buffer":var o=n.responseText;r=Buffer.alloc(o.length);for(var c=0;c<o.length;c++)r[c]=o.charCodeAt(c);return;case"json":return void(r=JSON.parse(n.responseText))}}},n.send(),i)throw i;return r};function xt(t){var e=-1;return function(t,e,n){var r=new XMLHttpRequest;r.open("HEAD",e,t),r.onreadystatechange=function(t){if(4===r.readyState){if(200!==r.status)return n(new h(s.EIO,"XHR HEAD error: response returned code "+r.status));try{var e=r.getResponseHeader("Content-Length");return n(null,e?parseInt(e,10):-1)}catch(t){return n(new h(s.EIO,"XHR HEAD error: Could not read content-length."))}}},r.send()}(!1,t,function(t,n){if(t)throw t;e=n}),e}var Bt={cache:"no-cache",keepalive:!1,mode:"cors",priority:"high",referrerPolicy:"no-referrer",window:null},Ut={cache:"no-cache",keepalive:!1,method:"HEAD",mode:"no-cors",priority:"high",referrerPolicy:"no-referrer",window:null};function Mt(t,e,n){var r;try{r=window.fetch(t,Bt)}catch(t){return n(new h(s.EINVAL,t.message))}r.then(function(t){if(!t.ok)return n(new h(s.EIO,"fetch error: response returned code "+t.status));switch(e){case"buffer":t.arrayBuffer().then(function(t){return n(null,Buffer.from(t))}).catch(function(t){return n(new h(s.EIO,t.message))});break;case"json":t.json().then(function(t){return n(null,t)}).catch(function(t){return n(new h(s.EIO,t.message))});break;default:n(new h(s.EINVAL,"Invalid download type: "+e))}}).catch(function(t){return n(new h(s.EIO,t.message))})}function zt(t,e){window.fetch(t,Ut).then(function(t){if(t.ok){var n=t.headers.get("Content-Length");return e(null,n?parseInt(n,10):-1)}return e(new h(s.EIO,"fetch HEAD error: response returned code "+t.status))}).catch(function(t){return e(new h(s.EIO,t.message))})}var Ct=function(){this._index={},this.addPath("/",new Yt)};Ct.fromListing=function(t){var e=new Ct,n=new Yt;e._index["/"]=n;for(var r=[["",t,n]];r.length>0;){var i=void 0,o=r.pop(),s=o[0],c=o[1],a=o[2];for(var u in c)if(c.hasOwnProperty(u)){var f=c[u],h=s+"/"+u;f?(e._index[h]=i=new Yt,r.push([h,f,i])):i=new jt(new d(l.FILE,-1,365)),a&&(a._ls[u]=i)}}return e},Ct.prototype.fileIterator=function(t){for(var e in this._index)if(this._index.hasOwnProperty(e))for(var n=this._index[e],r=0,i=n.getListing();r<i.length;r+=1){var o=i[r],s=n.getItem(o);Vt(s)&&t(s.getData())}},Ct.prototype.addPath=function(t,e){if(!e)throw new Error("Inode must be specified");if("/"!==t[0])throw new Error("Path must be absolute, got: "+t);if(this._index.hasOwnProperty(t))return this._index[t]===e;var n=this._split_path(t),r=n[0],i=n[1],o=this._index[r];return!(void 0===o&&"/"!==t&&(o=new Yt,!this.addPath(r,o)))&&(!("/"!==t&&!o.addItem(i,e))&&(Xt(e)&&(this._index[t]=e),!0))},Ct.prototype.addPathFast=function(t,e){var n=t.lastIndexOf("/"),r=0===n?"/":t.substring(0,n),i=t.substring(n+1),o=this._index[r];return void 0===o&&(o=new Yt,this.addPathFast(r,o)),!!o.addItem(i,e)&&(e.isDir()&&(this._index[t]=e),!0)},Ct.prototype.removePath=function(t){var e=this._split_path(t),n=e[0],r=e[1],i=this._index[n];if(void 0===i)return null;var o=i.remItem(r);if(null===o)return null;if(Xt(o)){for(var s=0,c=o.getListing();s<c.length;s+=1){var a=c[s];this.removePath(t+"/"+a)}"/"!==t&&delete this._index[t]}return o},Ct.prototype.ls=function(t){var e=this._index[t];return void 0===e?null:e.getListing()},Ct.prototype.getInode=function(t){var e=this._split_path(t),n=e[0],r=e[1],i=this._index[n];return void 0===i?null:n===t?i:i.getItem(r)},Ct.prototype._split_path=function(t){var e=a.dirname(t);return[e,t.substr(e.length+("/"===e?0:1))]};var jt=function(t){this.data=t};jt.prototype.isFile=function(){return!0},jt.prototype.isDir=function(){return!1},jt.prototype.getData=function(){return this.data},jt.prototype.setData=function(t){this.data=t};var Yt=function(t){void 0===t&&(t=null),this.data=t,this._ls={}};function Vt(t){return!!t&&t.isFile()}function Xt(t){return!!t&&t.isDir()}Yt.prototype.isFile=function(){return!1},Yt.prototype.isDir=function(){return!0},Yt.prototype.getData=function(){return this.data},Yt.prototype.getStats=function(){return new d(l.DIRECTORY,4096,365)},Yt.prototype.getListing=function(){return Object.keys(this._ls)},Yt.prototype.getItem=function(t){var e=this._ls[t];return e||null},Yt.prototype.addItem=function(t,e){return!(t in this._ls)&&(this._ls[t]=e,!0)},Yt.prototype.remItem=function(t){var e=this._ls[t];return void 0===e?null:(delete this._ls[t],e)};var Wt=function(t){function e(e,n){void 0===n&&(n=""),t.call(this),n.length>0&&"/"!==n.charAt(n.length-1)&&(n+="/"),this.prefixUrl=n,this._index=Ct.fromListing(e),this._requestFileAsyncInternal=Mt,this._requestFileSizeAsyncInternal=zt,this._requestFileSyncInternal=Dt,this._requestFileSizeSyncInternal=xt}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.Create=function(t,n){void 0===t.index&&(t.index="index.json"),"string"==typeof t.index?Rt(t.index,"json",function(r,i){r?n(r):n(null,new e(i,t.baseUrl))}):n(null,new e(t.index,t.baseUrl))},e.isAvailable=function(){return!0},e.prototype.empty=function(){this._index.fileIterator(function(t){t.fileData=null})},e.prototype.getName=function(){return e.Name},e.prototype.diskSpace=function(t,e){e(0,0)},e.prototype.isReadOnly=function(){return!0},e.prototype.supportsLinks=function(){return!1},e.prototype.supportsProps=function(){return!1},e.prototype.supportsSynch=function(){return!0},e.prototype.preloadFile=function(t,e){var n=this._index.getInode(t);if(!Vt(n))throw h.EISDIR(t);if(null===n)throw h.ENOENT(t);var r=n.getData();r.size=e.length,r.fileData=e},e.prototype.stat=function(t,e,n){var r,i=this._index.getInode(t);if(null===i)return n(h.ENOENT(t));Vt(i)?(r=i.getData(),!e&&r.size<0?this._requestFileSizeAsync(t,function(t,e){if(t)return n(t);r.size=e,n(null,d.clone(r))}):n(null,d.clone(r))):Xt(i)?(r=i.getStats(),n(null,r)):n(h.FileError(s.EINVAL,t))},e.prototype.statSync=function(t,e){var n,r=this._index.getInode(t);if(null===r)throw h.ENOENT(t);if(Vt(r))(n=r.getData()).size<0&&(n.size=this._requestFileSizeSync(t));else{if(!Xt(r))throw h.FileError(s.EINVAL,t);n=r.getStats()}return n},e.prototype.open=function(t,e,n,r){if(e.isWriteable())return r(new h(s.EPERM,t));var i=this,o=this._index.getInode(t);if(null===o)return r(h.ENOENT(t));if(!Vt(o))return r(h.EISDIR(t));var c=o.getData();switch(e.pathExistsAction()){case f.THROW_EXCEPTION:case f.TRUNCATE_FILE:return r(h.EEXIST(t));case f.NOP:if(c.fileData)return r(null,new Q(i,t,e,d.clone(c),c.fileData));this._requestFileAsync(t,"buffer",function(n,o){return n?r(n):(c.size=o.length,c.fileData=o,r(null,new Q(i,t,e,d.clone(c),o)))});break;default:return r(new h(s.EINVAL,"Invalid FileMode object."))}},e.prototype.openSync=function(t,e,n){if(e.isWriteable())throw new h(s.EPERM,t);var r=this._index.getInode(t);if(null===r)throw h.ENOENT(t);if(!Vt(r))throw h.EISDIR(t);var i=r.getData();switch(e.pathExistsAction()){case f.THROW_EXCEPTION:case f.TRUNCATE_FILE:throw h.EEXIST(t);case f.NOP:if(i.fileData)return new Q(this,t,e,d.clone(i),i.fileData);var o=this._requestFileSync(t,"buffer");return i.size=o.length,i.fileData=o,new Q(this,t,e,d.clone(i),o);default:throw new h(s.EINVAL,"Invalid FileMode object.")}},e.prototype.readdir=function(t,e){try{e(null,this.readdirSync(t))}catch(t){e(t)}},e.prototype.readdirSync=function(t){var e=this._index.getInode(t);if(null===e)throw h.ENOENT(t);if(Xt(e))return e.getListing();throw h.ENOTDIR(t)},e.prototype.readFile=function(t,e,n,r){var i=r;this.open(t,n,420,function(t,n){if(t)return r(t);r=function(t,e){n.close(function(n){return t||(t=n),i(t,e)})};var o=n.getBuffer();null===e?r(t,Y(o)):function(t,e,n){try{n(null,t.toString(e))}catch(t){n(t)}}(o,e,r)})},e.prototype.readFileSync=function(t,e,n){var r=this.openSync(t,n,420);try{var i=r.getBuffer();return null===e?Y(i):i.toString(e)}finally{r.closeSync()}},e.prototype._getHTTPPath=function(t){return"/"===t.charAt(0)&&(t=t.slice(1)),this.prefixUrl+t},e.prototype._requestFileAsync=function(t,e,n){this._requestFileAsyncInternal(this._getHTTPPath(t),e,n)},e.prototype._requestFileSync=function(t,e){return this._requestFileSyncInternal(this._getHTTPPath(t),e)},e.prototype._requestFileSizeAsync=function(t,e){this._requestFileSizeAsyncInternal(this._getHTTPPath(t),e)},e.prototype._requestFileSizeSync=function(t){return this._requestFileSizeSyncInternal(this._getHTTPPath(t))},e}(H);Wt.Name="HTTPRequest",Wt.Options={index:{type:["string","object"],optional:!0,description:"URL to a file index as a JSON file or the file index object itself, generated with the make_http_index script. Defaults to `index.json`."},baseUrl:{type:"string",optional:!0,description:"Used as the URL prefix for fetched files. Default: Fetch files relative to the index."}};var Ht={InMemory:ft,IndexedDB:wt,MountableFileSystem:mt,OverlayFS:Lt,HTTPRequest:Wt};function qt(t){switch(t){case"fs":return D;case"path":return a;case"buffer":return c;case"process":return process;case"bfs_utils":return W;default:return Ht[t]}}function Jt(t){return D.initialize(t)}function Kt(t,e){var n=t.fs;if(!n)return e(new h(s.EPERM,'Missing "fs" property on configuration object.'));var r=t.options,i=0,o=!1;function c(){if(!o){o=!0;var t=Ht[n];t?t.Create(r,e):e(new h(s.EPERM,"File system "+n+" is not available in BrowserFS."))}}if(null!==r&&"object"==typeof r){var a=!1;Object.keys(r).filter(function(t){return"fs"!==t}).forEach(function(t){var n=r[t];null!==n&&"object"==typeof n&&n.fs&&(i++,Kt(n,function(n,s){if(i--,n){if(o)return;o=!0,e(n)}else r[t]=s,0===i&&a&&c()}))}),a=!0}0===i&&c()}process.initializeTTYs&&process.initializeTTYs(),e.BFSRequire=qt,e.Errors=p,e.FileSystem=Ht,e.configure=function(t,e){Kt(t,function(t,n){n?(Jt(n),e()):e(t)})},e.getFileSystem=Kt,e.initialize=Jt,e.install=function(t){t.Buffer=Buffer,t.process=process;var e=t.require?t.require:null;t.require=function(t){var n=qt(t);return n||e.apply(null,Array.prototype.slice.call(arguments,0))}},e.registerFileSystem=function(t,e){Ht[t]=e}}).call(this,n(0))},function(t,e,n){"use strict";(function(t){
/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <http://feross.org>
 * @license  MIT
 */
var r=n(3),i=n(4),o=n(5);function s(){return a.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function c(t,e){if(s()<e)throw new RangeError("Invalid typed array length");return a.TYPED_ARRAY_SUPPORT?(t=new Uint8Array(e)).__proto__=a.prototype:(null===t&&(t=new a(e)),t.length=e),t}function a(t,e,n){if(!(a.TYPED_ARRAY_SUPPORT||this instanceof a))return new a(t,e,n);if("number"==typeof t){if("string"==typeof e)throw new Error("If encoding is specified then the first argument must be a string");return h(this,t)}return u(this,t,e,n)}function u(t,e,n,r){if("number"==typeof e)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&e instanceof ArrayBuffer?function(t,e,n,r){if(e.byteLength,n<0||e.byteLength<n)throw new RangeError("'offset' is out of bounds");if(e.byteLength<n+(r||0))throw new RangeError("'length' is out of bounds");e=void 0===n&&void 0===r?new Uint8Array(e):void 0===r?new Uint8Array(e,n):new Uint8Array(e,n,r);a.TYPED_ARRAY_SUPPORT?(t=e).__proto__=a.prototype:t=p(t,e);return t}(t,e,n,r):"string"==typeof e?function(t,e,n){"string"==typeof n&&""!==n||(n="utf8");if(!a.isEncoding(n))throw new TypeError('"encoding" must be a valid string encoding');var r=0|y(e,n),i=(t=c(t,r)).write(e,n);i!==r&&(t=t.slice(0,i));return t}(t,e,n):function(t,e){if(a.isBuffer(e)){var n=0|l(e.length);return 0===(t=c(t,n)).length?t:(e.copy(t,0,0,n),t)}if(e){if("undefined"!=typeof ArrayBuffer&&e.buffer instanceof ArrayBuffer||"length"in e)return"number"!=typeof e.length||function(t){return t!=t}(e.length)?c(t,0):p(t,e);if("Buffer"===e.type&&o(e.data))return p(t,e.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(t,e)}function f(t){if("number"!=typeof t)throw new TypeError('"size" argument must be a number');if(t<0)throw new RangeError('"size" argument must not be negative')}function h(t,e){if(f(e),t=c(t,e<0?0:0|l(e)),!a.TYPED_ARRAY_SUPPORT)for(var n=0;n<e;++n)t[n]=0;return t}function p(t,e){var n=e.length<0?0:0|l(e.length);t=c(t,n);for(var r=0;r<n;r+=1)t[r]=255&e[r];return t}function l(t){if(t>=s())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+s().toString(16)+" bytes");return 0|t}function y(t,e){if(a.isBuffer(t))return t.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(t)||t instanceof ArrayBuffer))return t.byteLength;"string"!=typeof t&&(t=""+t);var n=t.length;if(0===n)return 0;for(var r=!1;;)switch(e){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":case void 0:return C(t).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return j(t).length;default:if(r)return C(t).length;e=(""+e).toLowerCase(),r=!0}}function d(t,e,n){var r=t[e];t[e]=t[n],t[n]=r}function g(t,e,n,r,i){if(0===t.length)return-1;if("string"==typeof n?(r=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),n=+n,isNaN(n)&&(n=i?0:t.length-1),n<0&&(n=t.length+n),n>=t.length){if(i)return-1;n=t.length-1}else if(n<0){if(!i)return-1;n=0}if("string"==typeof e&&(e=a.from(e,r)),a.isBuffer(e))return 0===e.length?-1:w(t,e,n,r,i);if("number"==typeof e)return e&=255,a.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(t,e,n):Uint8Array.prototype.lastIndexOf.call(t,e,n):w(t,[e],n,r,i);throw new TypeError("val must be string, number or Buffer")}function w(t,e,n,r,i){var o,s=1,c=t.length,a=e.length;if(void 0!==r&&("ucs2"===(r=String(r).toLowerCase())||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(t.length<2||e.length<2)return-1;s=2,c/=2,a/=2,n/=2}function u(t,e){return 1===s?t[e]:t.readUInt16BE(e*s)}if(i){var f=-1;for(o=n;o<c;o++)if(u(t,o)===u(e,-1===f?0:o-f)){if(-1===f&&(f=o),o-f+1===a)return f*s}else-1!==f&&(o-=o-f),f=-1}else for(n+a>c&&(n=c-a),o=n;o>=0;o--){for(var h=!0,p=0;p<a;p++)if(u(t,o+p)!==u(e,p)){h=!1;break}if(h)return o}return-1}function m(t,e,n,r){n=Number(n)||0;var i=t.length-n;r?(r=Number(r))>i&&(r=i):r=i;var o=e.length;if(o%2!=0)throw new TypeError("Invalid hex string");r>o/2&&(r=o/2);for(var s=0;s<r;++s){var c=parseInt(e.substr(2*s,2),16);if(isNaN(c))return s;t[n+s]=c}return s}function v(t,e,n,r){return Y(C(e,t.length-n),t,n,r)}function E(t,e,n,r){return Y(function(t){for(var e=[],n=0;n<t.length;++n)e.push(255&t.charCodeAt(n));return e}(e),t,n,r)}function S(t,e,n,r){return E(t,e,n,r)}function _(t,e,n,r){return Y(j(e),t,n,r)}function b(t,e,n,r){return Y(function(t,e){for(var n,r,i,o=[],s=0;s<t.length&&!((e-=2)<0);++s)n=t.charCodeAt(s),r=n>>8,i=n%256,o.push(i),o.push(r);return o}(e,t.length-n),t,n,r)}function N(t,e,n){return 0===e&&n===t.length?r.fromByteArray(t):r.fromByteArray(t.slice(e,n))}function I(t,e,n){n=Math.min(t.length,n);for(var r=[],i=e;i<n;){var o,s,c,a,u=t[i],f=null,h=u>239?4:u>223?3:u>191?2:1;if(i+h<=n)switch(h){case 1:u<128&&(f=u);break;case 2:128==(192&(o=t[i+1]))&&(a=(31&u)<<6|63&o)>127&&(f=a);break;case 3:o=t[i+1],s=t[i+2],128==(192&o)&&128==(192&s)&&(a=(15&u)<<12|(63&o)<<6|63&s)>2047&&(a<55296||a>57343)&&(f=a);break;case 4:o=t[i+1],s=t[i+2],c=t[i+3],128==(192&o)&&128==(192&s)&&128==(192&c)&&(a=(15&u)<<18|(63&o)<<12|(63&s)<<6|63&c)>65535&&a<1114112&&(f=a)}null===f?(f=65533,h=1):f>65535&&(f-=65536,r.push(f>>>10&1023|55296),f=56320|1023&f),r.push(f),i+=h}return function(t){var e=t.length;if(e<=T)return String.fromCharCode.apply(String,t);var n="",r=0;for(;r<e;)n+=String.fromCharCode.apply(String,t.slice(r,r+=T));return n}(r)}e.Buffer=a,e.SlowBuffer=function(t){+t!=t&&(t=0);return a.alloc(+t)},e.INSPECT_MAX_BYTES=50,a.TYPED_ARRAY_SUPPORT=void 0!==t.TYPED_ARRAY_SUPPORT?t.TYPED_ARRAY_SUPPORT:function(){try{var t=new Uint8Array(1);return t.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===t.foo()&&"function"==typeof t.subarray&&0===t.subarray(1,1).byteLength}catch(t){return!1}}(),e.kMaxLength=s(),a.poolSize=8192,a._augment=function(t){return t.__proto__=a.prototype,t},a.from=function(t,e,n){return u(null,t,e,n)},a.TYPED_ARRAY_SUPPORT&&(a.prototype.__proto__=Uint8Array.prototype,a.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&a[Symbol.species]===a&&Object.defineProperty(a,Symbol.species,{value:null,configurable:!0})),a.alloc=function(t,e,n){return function(t,e,n,r){return f(e),e<=0?c(t,e):void 0!==n?"string"==typeof r?c(t,e).fill(n,r):c(t,e).fill(n):c(t,e)}(null,t,e,n)},a.allocUnsafe=function(t){return h(null,t)},a.allocUnsafeSlow=function(t){return h(null,t)},a.isBuffer=function(t){return!(null==t||!t._isBuffer)},a.compare=function(t,e){if(!a.isBuffer(t)||!a.isBuffer(e))throw new TypeError("Arguments must be Buffers");if(t===e)return 0;for(var n=t.length,r=e.length,i=0,o=Math.min(n,r);i<o;++i)if(t[i]!==e[i]){n=t[i],r=e[i];break}return n<r?-1:r<n?1:0},a.isEncoding=function(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},a.concat=function(t,e){if(!o(t))throw new TypeError('"list" argument must be an Array of Buffers');if(0===t.length)return a.alloc(0);var n;if(void 0===e)for(e=0,n=0;n<t.length;++n)e+=t[n].length;var r=a.allocUnsafe(e),i=0;for(n=0;n<t.length;++n){var s=t[n];if(!a.isBuffer(s))throw new TypeError('"list" argument must be an Array of Buffers');s.copy(r,i),i+=s.length}return r},a.byteLength=y,a.prototype._isBuffer=!0,a.prototype.swap16=function(){var t=this.length;if(t%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var e=0;e<t;e+=2)d(this,e,e+1);return this},a.prototype.swap32=function(){var t=this.length;if(t%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var e=0;e<t;e+=4)d(this,e,e+3),d(this,e+1,e+2);return this},a.prototype.swap64=function(){var t=this.length;if(t%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var e=0;e<t;e+=8)d(this,e,e+7),d(this,e+1,e+6),d(this,e+2,e+5),d(this,e+3,e+4);return this},a.prototype.toString=function(){var t=0|this.length;return 0===t?"":0===arguments.length?I(this,0,t):function(t,e,n){var r=!1;if((void 0===e||e<0)&&(e=0),e>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if((n>>>=0)<=(e>>>=0))return"";for(t||(t="utf8");;)switch(t){case"hex":return P(this,e,n);case"utf8":case"utf-8":return I(this,e,n);case"ascii":return O(this,e,n);case"latin1":case"binary":return F(this,e,n);case"base64":return N(this,e,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return k(this,e,n);default:if(r)throw new TypeError("Unknown encoding: "+t);t=(t+"").toLowerCase(),r=!0}}.apply(this,arguments)},a.prototype.equals=function(t){if(!a.isBuffer(t))throw new TypeError("Argument must be a Buffer");return this===t||0===a.compare(this,t)},a.prototype.inspect=function(){var t="",n=e.INSPECT_MAX_BYTES;return this.length>0&&(t=this.toString("hex",0,n).match(/.{2}/g).join(" "),this.length>n&&(t+=" ... ")),"<Buffer "+t+">"},a.prototype.compare=function(t,e,n,r,i){if(!a.isBuffer(t))throw new TypeError("Argument must be a Buffer");if(void 0===e&&(e=0),void 0===n&&(n=t?t.length:0),void 0===r&&(r=0),void 0===i&&(i=this.length),e<0||n>t.length||r<0||i>this.length)throw new RangeError("out of range index");if(r>=i&&e>=n)return 0;if(r>=i)return-1;if(e>=n)return 1;if(e>>>=0,n>>>=0,r>>>=0,i>>>=0,this===t)return 0;for(var o=i-r,s=n-e,c=Math.min(o,s),u=this.slice(r,i),f=t.slice(e,n),h=0;h<c;++h)if(u[h]!==f[h]){o=u[h],s=f[h];break}return o<s?-1:s<o?1:0},a.prototype.includes=function(t,e,n){return-1!==this.indexOf(t,e,n)},a.prototype.indexOf=function(t,e,n){return g(this,t,e,n,!0)},a.prototype.lastIndexOf=function(t,e,n){return g(this,t,e,n,!1)},a.prototype.write=function(t,e,n,r){if(void 0===e)r="utf8",n=this.length,e=0;else if(void 0===n&&"string"==typeof e)r=e,n=this.length,e=0;else{if(!isFinite(e))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");e|=0,isFinite(n)?(n|=0,void 0===r&&(r="utf8")):(r=n,n=void 0)}var i=this.length-e;if((void 0===n||n>i)&&(n=i),t.length>0&&(n<0||e<0)||e>this.length)throw new RangeError("Attempt to write outside buffer bounds");r||(r="utf8");for(var o=!1;;)switch(r){case"hex":return m(this,t,e,n);case"utf8":case"utf-8":return v(this,t,e,n);case"ascii":return E(this,t,e,n);case"latin1":case"binary":return S(this,t,e,n);case"base64":return _(this,t,e,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return b(this,t,e,n);default:if(o)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),o=!0}},a.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var T=4096;function O(t,e,n){var r="";n=Math.min(t.length,n);for(var i=e;i<n;++i)r+=String.fromCharCode(127&t[i]);return r}function F(t,e,n){var r="";n=Math.min(t.length,n);for(var i=e;i<n;++i)r+=String.fromCharCode(t[i]);return r}function P(t,e,n){var r=t.length;(!e||e<0)&&(e=0),(!n||n<0||n>r)&&(n=r);for(var i="",o=e;o<n;++o)i+=z(t[o]);return i}function k(t,e,n){for(var r=t.slice(e,n),i="",o=0;o<r.length;o+=2)i+=String.fromCharCode(r[o]+256*r[o+1]);return i}function A(t,e,n){if(t%1!=0||t<0)throw new RangeError("offset is not uint");if(t+e>n)throw new RangeError("Trying to access beyond buffer length")}function L(t,e,n,r,i,o){if(!a.isBuffer(t))throw new TypeError('"buffer" argument must be a Buffer instance');if(e>i||e<o)throw new RangeError('"value" argument is out of bounds');if(n+r>t.length)throw new RangeError("Index out of range")}function R(t,e,n,r){e<0&&(e=65535+e+1);for(var i=0,o=Math.min(t.length-n,2);i<o;++i)t[n+i]=(e&255<<8*(r?i:1-i))>>>8*(r?i:1-i)}function D(t,e,n,r){e<0&&(e=4294967295+e+1);for(var i=0,o=Math.min(t.length-n,4);i<o;++i)t[n+i]=e>>>8*(r?i:3-i)&255}function x(t,e,n,r,i,o){if(n+r>t.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function B(t,e,n,r,o){return o||x(t,0,n,4),i.write(t,e,n,r,23,4),n+4}function U(t,e,n,r,o){return o||x(t,0,n,8),i.write(t,e,n,r,52,8),n+8}a.prototype.slice=function(t,e){var n,r=this.length;if(t=~~t,e=void 0===e?r:~~e,t<0?(t+=r)<0&&(t=0):t>r&&(t=r),e<0?(e+=r)<0&&(e=0):e>r&&(e=r),e<t&&(e=t),a.TYPED_ARRAY_SUPPORT)(n=this.subarray(t,e)).__proto__=a.prototype;else{var i=e-t;n=new a(i,void 0);for(var o=0;o<i;++o)n[o]=this[o+t]}return n},a.prototype.readUIntLE=function(t,e,n){t|=0,e|=0,n||A(t,e,this.length);for(var r=this[t],i=1,o=0;++o<e&&(i*=256);)r+=this[t+o]*i;return r},a.prototype.readUIntBE=function(t,e,n){t|=0,e|=0,n||A(t,e,this.length);for(var r=this[t+--e],i=1;e>0&&(i*=256);)r+=this[t+--e]*i;return r},a.prototype.readUInt8=function(t,e){return e||A(t,1,this.length),this[t]},a.prototype.readUInt16LE=function(t,e){return e||A(t,2,this.length),this[t]|this[t+1]<<8},a.prototype.readUInt16BE=function(t,e){return e||A(t,2,this.length),this[t]<<8|this[t+1]},a.prototype.readUInt32LE=function(t,e){return e||A(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+16777216*this[t+3]},a.prototype.readUInt32BE=function(t,e){return e||A(t,4,this.length),16777216*this[t]+(this[t+1]<<16|this[t+2]<<8|this[t+3])},a.prototype.readIntLE=function(t,e,n){t|=0,e|=0,n||A(t,e,this.length);for(var r=this[t],i=1,o=0;++o<e&&(i*=256);)r+=this[t+o]*i;return r>=(i*=128)&&(r-=Math.pow(2,8*e)),r},a.prototype.readIntBE=function(t,e,n){t|=0,e|=0,n||A(t,e,this.length);for(var r=e,i=1,o=this[t+--r];r>0&&(i*=256);)o+=this[t+--r]*i;return o>=(i*=128)&&(o-=Math.pow(2,8*e)),o},a.prototype.readInt8=function(t,e){return e||A(t,1,this.length),128&this[t]?-1*(255-this[t]+1):this[t]},a.prototype.readInt16LE=function(t,e){e||A(t,2,this.length);var n=this[t]|this[t+1]<<8;return 32768&n?4294901760|n:n},a.prototype.readInt16BE=function(t,e){e||A(t,2,this.length);var n=this[t+1]|this[t]<<8;return 32768&n?4294901760|n:n},a.prototype.readInt32LE=function(t,e){return e||A(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24},a.prototype.readInt32BE=function(t,e){return e||A(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]},a.prototype.readFloatLE=function(t,e){return e||A(t,4,this.length),i.read(this,t,!0,23,4)},a.prototype.readFloatBE=function(t,e){return e||A(t,4,this.length),i.read(this,t,!1,23,4)},a.prototype.readDoubleLE=function(t,e){return e||A(t,8,this.length),i.read(this,t,!0,52,8)},a.prototype.readDoubleBE=function(t,e){return e||A(t,8,this.length),i.read(this,t,!1,52,8)},a.prototype.writeUIntLE=function(t,e,n,r){(t=+t,e|=0,n|=0,r)||L(this,t,e,n,Math.pow(2,8*n)-1,0);var i=1,o=0;for(this[e]=255&t;++o<n&&(i*=256);)this[e+o]=t/i&255;return e+n},a.prototype.writeUIntBE=function(t,e,n,r){(t=+t,e|=0,n|=0,r)||L(this,t,e,n,Math.pow(2,8*n)-1,0);var i=n-1,o=1;for(this[e+i]=255&t;--i>=0&&(o*=256);)this[e+i]=t/o&255;return e+n},a.prototype.writeUInt8=function(t,e,n){return t=+t,e|=0,n||L(this,t,e,1,255,0),a.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),this[e]=255&t,e+1},a.prototype.writeUInt16LE=function(t,e,n){return t=+t,e|=0,n||L(this,t,e,2,65535,0),a.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8):R(this,t,e,!0),e+2},a.prototype.writeUInt16BE=function(t,e,n){return t=+t,e|=0,n||L(this,t,e,2,65535,0),a.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=255&t):R(this,t,e,!1),e+2},a.prototype.writeUInt32LE=function(t,e,n){return t=+t,e|=0,n||L(this,t,e,4,4294967295,0),a.TYPED_ARRAY_SUPPORT?(this[e+3]=t>>>24,this[e+2]=t>>>16,this[e+1]=t>>>8,this[e]=255&t):D(this,t,e,!0),e+4},a.prototype.writeUInt32BE=function(t,e,n){return t=+t,e|=0,n||L(this,t,e,4,4294967295,0),a.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t):D(this,t,e,!1),e+4},a.prototype.writeIntLE=function(t,e,n,r){if(t=+t,e|=0,!r){var i=Math.pow(2,8*n-1);L(this,t,e,n,i-1,-i)}var o=0,s=1,c=0;for(this[e]=255&t;++o<n&&(s*=256);)t<0&&0===c&&0!==this[e+o-1]&&(c=1),this[e+o]=(t/s>>0)-c&255;return e+n},a.prototype.writeIntBE=function(t,e,n,r){if(t=+t,e|=0,!r){var i=Math.pow(2,8*n-1);L(this,t,e,n,i-1,-i)}var o=n-1,s=1,c=0;for(this[e+o]=255&t;--o>=0&&(s*=256);)t<0&&0===c&&0!==this[e+o+1]&&(c=1),this[e+o]=(t/s>>0)-c&255;return e+n},a.prototype.writeInt8=function(t,e,n){return t=+t,e|=0,n||L(this,t,e,1,127,-128),a.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),t<0&&(t=255+t+1),this[e]=255&t,e+1},a.prototype.writeInt16LE=function(t,e,n){return t=+t,e|=0,n||L(this,t,e,2,32767,-32768),a.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8):R(this,t,e,!0),e+2},a.prototype.writeInt16BE=function(t,e,n){return t=+t,e|=0,n||L(this,t,e,2,32767,-32768),a.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=255&t):R(this,t,e,!1),e+2},a.prototype.writeInt32LE=function(t,e,n){return t=+t,e|=0,n||L(this,t,e,4,2147483647,-2147483648),a.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8,this[e+2]=t>>>16,this[e+3]=t>>>24):D(this,t,e,!0),e+4},a.prototype.writeInt32BE=function(t,e,n){return t=+t,e|=0,n||L(this,t,e,4,2147483647,-2147483648),t<0&&(t=4294967295+t+1),a.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t):D(this,t,e,!1),e+4},a.prototype.writeFloatLE=function(t,e,n){return B(this,t,e,!0,n)},a.prototype.writeFloatBE=function(t,e,n){return B(this,t,e,!1,n)},a.prototype.writeDoubleLE=function(t,e,n){return U(this,t,e,!0,n)},a.prototype.writeDoubleBE=function(t,e,n){return U(this,t,e,!1,n)},a.prototype.copy=function(t,e,n,r){if(n||(n=0),r||0===r||(r=this.length),e>=t.length&&(e=t.length),e||(e=0),r>0&&r<n&&(r=n),r===n)return 0;if(0===t.length||0===this.length)return 0;if(e<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("sourceStart out of bounds");if(r<0)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),t.length-e<r-n&&(r=t.length-e+n);var i,o=r-n;if(this===t&&n<e&&e<r)for(i=o-1;i>=0;--i)t[i+e]=this[i+n];else if(o<1e3||!a.TYPED_ARRAY_SUPPORT)for(i=0;i<o;++i)t[i+e]=this[i+n];else Uint8Array.prototype.set.call(t,this.subarray(n,n+o),e);return o},a.prototype.fill=function(t,e,n,r){if("string"==typeof t){if("string"==typeof e?(r=e,e=0,n=this.length):"string"==typeof n&&(r=n,n=this.length),1===t.length){var i=t.charCodeAt(0);i<256&&(t=i)}if(void 0!==r&&"string"!=typeof r)throw new TypeError("encoding must be a string");if("string"==typeof r&&!a.isEncoding(r))throw new TypeError("Unknown encoding: "+r)}else"number"==typeof t&&(t&=255);if(e<0||this.length<e||this.length<n)throw new RangeError("Out of range index");if(n<=e)return this;var o;if(e>>>=0,n=void 0===n?this.length:n>>>0,t||(t=0),"number"==typeof t)for(o=e;o<n;++o)this[o]=t;else{var s=a.isBuffer(t)?t:C(new a(t,r).toString()),c=s.length;for(o=0;o<n-e;++o)this[o+e]=s[o%c]}return this};var M=/[^+\/0-9A-Za-z-_]/g;function z(t){return t<16?"0"+t.toString(16):t.toString(16)}function C(t,e){var n;e=e||1/0;for(var r=t.length,i=null,o=[],s=0;s<r;++s){if((n=t.charCodeAt(s))>55295&&n<57344){if(!i){if(n>56319){(e-=3)>-1&&o.push(239,191,189);continue}if(s+1===r){(e-=3)>-1&&o.push(239,191,189);continue}i=n;continue}if(n<56320){(e-=3)>-1&&o.push(239,191,189),i=n;continue}n=65536+(i-55296<<10|n-56320)}else i&&(e-=3)>-1&&o.push(239,191,189);if(i=null,n<128){if((e-=1)<0)break;o.push(n)}else if(n<2048){if((e-=2)<0)break;o.push(n>>6|192,63&n|128)}else if(n<65536){if((e-=3)<0)break;o.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((e-=4)<0)break;o.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return o}function j(t){return r.toByteArray(function(t){if((t=function(t){return t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")}(t).replace(M,"")).length<2)return"";for(;t.length%4!=0;)t+="=";return t}(t))}function Y(t,e,n,r){for(var i=0;i<r&&!(i+n>=e.length||i>=t.length);++i)e[i+n]=t[i];return i}}).call(this,n(0))},function(t,e,n){"use strict";e.byteLength=function(t){var e=u(t),n=e[0],r=e[1];return 3*(n+r)/4-r},e.toByteArray=function(t){var e,n,r=u(t),s=r[0],c=r[1],a=new o(function(t,e,n){return 3*(e+n)/4-n}(0,s,c)),f=0,h=c>0?s-4:s;for(n=0;n<h;n+=4)e=i[t.charCodeAt(n)]<<18|i[t.charCodeAt(n+1)]<<12|i[t.charCodeAt(n+2)]<<6|i[t.charCodeAt(n+3)],a[f++]=e>>16&255,a[f++]=e>>8&255,a[f++]=255&e;2===c&&(e=i[t.charCodeAt(n)]<<2|i[t.charCodeAt(n+1)]>>4,a[f++]=255&e);1===c&&(e=i[t.charCodeAt(n)]<<10|i[t.charCodeAt(n+1)]<<4|i[t.charCodeAt(n+2)]>>2,a[f++]=e>>8&255,a[f++]=255&e);return a},e.fromByteArray=function(t){for(var e,n=t.length,i=n%3,o=[],s=0,c=n-i;s<c;s+=16383)o.push(h(t,s,s+16383>c?c:s+16383));1===i?(e=t[n-1],o.push(r[e>>2]+r[e<<4&63]+"==")):2===i&&(e=(t[n-2]<<8)+t[n-1],o.push(r[e>>10]+r[e>>4&63]+r[e<<2&63]+"="));return o.join("")};for(var r=[],i=[],o="undefined"!=typeof Uint8Array?Uint8Array:Array,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",c=0,a=s.length;c<a;++c)r[c]=s[c],i[s.charCodeAt(c)]=c;function u(t){var e=t.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=t.indexOf("=");return-1===n&&(n=e),[n,n===e?0:4-n%4]}function f(t){return r[t>>18&63]+r[t>>12&63]+r[t>>6&63]+r[63&t]}function h(t,e,n){for(var r,i=[],o=e;o<n;o+=3)r=(t[o]<<16&16711680)+(t[o+1]<<8&65280)+(255&t[o+2]),i.push(f(r));return i.join("")}i["-".charCodeAt(0)]=62,i["_".charCodeAt(0)]=63},function(t,e){
/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */
e.read=function(t,e,n,r,i){var o,s,c=8*i-r-1,a=(1<<c)-1,u=a>>1,f=-7,h=n?i-1:0,p=n?-1:1,l=t[e+h];for(h+=p,o=l&(1<<-f)-1,l>>=-f,f+=c;f>0;o=256*o+t[e+h],h+=p,f-=8);for(s=o&(1<<-f)-1,o>>=-f,f+=r;f>0;s=256*s+t[e+h],h+=p,f-=8);if(0===o)o=1-u;else{if(o===a)return s?NaN:1/0*(l?-1:1);s+=Math.pow(2,r),o-=u}return(l?-1:1)*s*Math.pow(2,o-r)},e.write=function(t,e,n,r,i,o){var s,c,a,u=8*o-i-1,f=(1<<u)-1,h=f>>1,p=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,l=r?0:o-1,y=r?1:-1,d=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(c=isNaN(e)?1:0,s=f):(s=Math.floor(Math.log(e)/Math.LN2),e*(a=Math.pow(2,-s))<1&&(s--,a*=2),(e+=s+h>=1?p/a:p*Math.pow(2,1-h))*a>=2&&(s++,a/=2),s+h>=f?(c=0,s=f):s+h>=1?(c=(e*a-1)*Math.pow(2,i),s+=h):(c=e*Math.pow(2,h-1)*Math.pow(2,i),s=0));i>=8;t[n+l]=255&c,l+=y,c/=256,i-=8);for(s=s<<i|c,u+=i;u>0;t[n+l]=255&s,l+=y,s/=256,u-=8);t[n+l-y]|=128*d}},function(t,e){var n={}.toString;t.exports=Array.isArray||function(t){return"[object Array]"==n.call(t)}},function(t,e){function n(t,e){for(var n=0,r=t.length-1;r>=0;r--){var i=t[r];"."===i?t.splice(r,1):".."===i?(t.splice(r,1),n++):n&&(t.splice(r,1),n--)}if(e)for(;n--;n)t.unshift("..");return t}var r=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/,i=function(t){return r.exec(t).slice(1)};function o(t,e){if(t.filter)return t.filter(e);for(var n=[],r=0;r<t.length;r++)e(t[r],r,t)&&n.push(t[r]);return n}e.resolve=function(){for(var t="",e=!1,r=arguments.length-1;r>=-1&&!e;r--){var i=r>=0?arguments[r]:process.cwd();if("string"!=typeof i)throw new TypeError("Arguments to path.resolve must be strings");i&&(t=i+"/"+t,e="/"===i.charAt(0))}return t=n(o(t.split("/"),function(t){return!!t}),!e).join("/"),(e?"/":"")+t||"."},e.normalize=function(t){var r=e.isAbsolute(t),i="/"===s(t,-1);return(t=n(o(t.split("/"),function(t){return!!t}),!r).join("/"))||r||(t="."),t&&i&&(t+="/"),(r?"/":"")+t},e.isAbsolute=function(t){return"/"===t.charAt(0)},e.join=function(){var t=Array.prototype.slice.call(arguments,0);return e.normalize(o(t,function(t,e){if("string"!=typeof t)throw new TypeError("Arguments to path.join must be strings");return t}).join("/"))},e.relative=function(t,n){function r(t){for(var e=0;e<t.length&&""===t[e];e++);for(var n=t.length-1;n>=0&&""===t[n];n--);return e>n?[]:t.slice(e,n-e+1)}t=e.resolve(t).substr(1),n=e.resolve(n).substr(1);for(var i=r(t.split("/")),o=r(n.split("/")),s=Math.min(i.length,o.length),c=s,a=0;a<s;a++)if(i[a]!==o[a]){c=a;break}var u=[];for(a=c;a<i.length;a++)u.push("..");return(u=u.concat(o.slice(c))).join("/")},e.sep="/",e.delimiter=":",e.dirname=function(t){var e=i(t),n=e[0],r=e[1];return n||r?(r&&(r=r.substr(0,r.length-1)),n+r):"."},e.basename=function(t,e){var n=i(t)[2];return e&&n.substr(-1*e.length)===e&&(n=n.substr(0,n.length-e.length)),n},e.extname=function(t){return i(t)[3]};var s="b"==="ab".substr(-1)?function(t,e,n){return t.substr(e,n)}:function(t,e,n){return e<0&&(e=t.length+e),t.substr(e,n)}}])});
